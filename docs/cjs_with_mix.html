<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>25 Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals | Bayesian Data Analysis in Ecology with R and Stan</title>
  <meta name="description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="25 Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals | Bayesian Data Analysis in Ecology with R and Stan" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/cover.jpg" />
  <meta property="og:description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="github-repo" content="TobiasRoth/BDAEcology" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="25 Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals | Bayesian Data Analysis in Ecology with R and Stan" />
  
  <meta name="twitter:description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="twitter:image" content="/images/cover.jpg" />

<meta name="author" content="Fränzi Korner-Nievergelt, Tobias Roth, Stefanie von Felten, Jerôme Guélat, Bettina Almasi, Pius Korner-Nievergelt" />


<meta name="date" content="2023-01-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dailynestsurv.html"/>
<link rel="next" href="referenzen.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="settings/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>I BASIC STATISTICS FOR ECOLOGISTS</b></span></li>
<li class="chapter" data-level="1" data-path="PART-I.html"><a href="PART-I.html"><i class="fa fa-check"></i><b>1</b> Introduction to PART I</a>
<ul>
<li class="chapter" data-level="1.1" data-path="PART-I.html"><a href="PART-I.html#further-reading"><i class="fa fa-check"></i><b>1.1</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Prerequisits: Basic statistical terms</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#variables-and-observations"><i class="fa fa-check"></i><b>2.1</b> Variables and observations</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#displaying-and-summarizing-variables"><i class="fa fa-check"></i><b>2.2</b> Displaying and summarizing variables</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basics.html"><a href="basics.html#correlations"><i class="fa fa-check"></i><b>2.2.1</b> Correlations</a></li>
<li class="chapter" data-level="2.2.2" data-path="basics.html"><a href="basics.html#principal-components-analyses-pca"><i class="fa fa-check"></i><b>2.2.2</b> Principal components analyses PCA</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#inferential-statistics"><i class="fa fa-check"></i><b>2.3</b> Inferential statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#uncertainty"><i class="fa fa-check"></i><b>2.3.1</b> Uncertainty</a></li>
<li class="chapter" data-level="2.3.2" data-path="basics.html"><a href="basics.html#standard-error"><i class="fa fa-check"></i><b>2.3.2</b> Standard error</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#bayes-theorem-and-the-common-aim-of-frequentist-and-bayesian-methods"><i class="fa fa-check"></i><b>2.4</b> Bayes theorem and the common aim of frequentist and Bayesian methods</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="basics.html"><a href="basics.html#bayes-theorem-for-discrete-events"><i class="fa fa-check"></i><b>2.4.1</b> Bayes theorem for discrete events</a></li>
<li class="chapter" data-level="2.4.2" data-path="basics.html"><a href="basics.html#bayes-theorem-for-continuous-parameters"><i class="fa fa-check"></i><b>2.4.2</b> Bayes theorem for continuous parameters</a></li>
<li class="chapter" data-level="2.4.3" data-path="basics.html"><a href="basics.html#estimating-a-mean-assuming-that-the-variance-is-known"><i class="fa fa-check"></i><b>2.4.3</b> Estimating a mean assuming that the variance is known</a></li>
<li class="chapter" data-level="2.4.4" data-path="basics.html"><a href="basics.html#estimating-the-mean-and-the-variance"><i class="fa fa-check"></i><b>2.4.4</b> Estimating the mean and the variance</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#classical-frequentist-tests-and-alternatives"><i class="fa fa-check"></i><b>2.5</b> Classical frequentist tests and alternatives</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="basics.html"><a href="basics.html#nullhypothesis-testing"><i class="fa fa-check"></i><b>2.5.1</b> Nullhypothesis testing</a></li>
<li class="chapter" data-level="2.5.2" data-path="basics.html"><a href="basics.html#comparison-of-a-sample-with-a-fixed-values-one-sample-t-test"><i class="fa fa-check"></i><b>2.5.2</b> Comparison of a sample with a fixed values (one-sample t-test)</a></li>
<li class="chapter" data-level="2.5.3" data-path="basics.html"><a href="basics.html#comparison-of-the-locations-between-two-groups-two-sample-t-test"><i class="fa fa-check"></i><b>2.5.3</b> Comparison of the locations between two groups (two-sample t-test)</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#summary"><i class="fa fa-check"></i><b>2.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="analyses_steps.html"><a href="analyses_steps.html"><i class="fa fa-check"></i><b>3</b> Data analysis step by step</a>
<ul>
<li class="chapter" data-level="3.1" data-path="analyses_steps.html"><a href="analyses_steps.html#step1"><i class="fa fa-check"></i><b>3.1</b> Plausibility of Data</a></li>
<li class="chapter" data-level="3.2" data-path="analyses_steps.html"><a href="analyses_steps.html#step2"><i class="fa fa-check"></i><b>3.2</b> Relationships</a></li>
<li class="chapter" data-level="3.3" data-path="analyses_steps.html"><a href="analyses_steps.html#step3"><i class="fa fa-check"></i><b>3.3</b> Data Distribution</a></li>
<li class="chapter" data-level="3.4" data-path="analyses_steps.html"><a href="analyses_steps.html#step4"><i class="fa fa-check"></i><b>3.4</b> Preparation of Explanatory Variables</a></li>
<li class="chapter" data-level="3.5" data-path="analyses_steps.html"><a href="analyses_steps.html#step5"><i class="fa fa-check"></i><b>3.5</b> Data Structure</a></li>
<li class="chapter" data-level="3.6" data-path="analyses_steps.html"><a href="analyses_steps.html#step6"><i class="fa fa-check"></i><b>3.6</b> Define Prior Distributions</a></li>
<li class="chapter" data-level="3.7" data-path="analyses_steps.html"><a href="analyses_steps.html#step7"><i class="fa fa-check"></i><b>3.7</b> Fit the Model</a></li>
<li class="chapter" data-level="3.8" data-path="analyses_steps.html"><a href="analyses_steps.html#step8"><i class="fa fa-check"></i><b>3.8</b> Check Model</a></li>
<li class="chapter" data-level="3.9" data-path="analyses_steps.html"><a href="analyses_steps.html#step9"><i class="fa fa-check"></i><b>3.9</b> Model Uncertainty</a></li>
<li class="chapter" data-level="3.10" data-path="analyses_steps.html"><a href="analyses_steps.html#step10"><i class="fa fa-check"></i><b>3.10</b> Draw Conclusions</a></li>
<li class="chapter" data-level="" data-path="analyses_steps.html"><a href="analyses_steps.html#further-reading-1"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>4</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="distributions.html"><a href="distributions.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="distributions.html"><a href="distributions.html#discrete-distributions"><i class="fa fa-check"></i><b>4.2</b> Discrete distributions</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="distributions.html"><a href="distributions.html#bernoulli-distribution"><i class="fa fa-check"></i><b>4.2.1</b> Bernoulli distribution</a></li>
<li class="chapter" data-level="4.2.2" data-path="distributions.html"><a href="distributions.html#binomial-distribution"><i class="fa fa-check"></i><b>4.2.2</b> Binomial distribution</a></li>
<li class="chapter" data-level="4.2.3" data-path="distributions.html"><a href="distributions.html#poisson-distribution"><i class="fa fa-check"></i><b>4.2.3</b> Poisson distribution</a></li>
<li class="chapter" data-level="4.2.4" data-path="distributions.html"><a href="distributions.html#negative-binomial-distribution"><i class="fa fa-check"></i><b>4.2.4</b> Negative-binomial distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="distributions.html"><a href="distributions.html#continuous-distributions"><i class="fa fa-check"></i><b>4.3</b> Continuous distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="distributions.html"><a href="distributions.html#beta-distribution"><i class="fa fa-check"></i><b>4.3.1</b> Beta distribution</a></li>
<li class="chapter" data-level="4.3.2" data-path="distributions.html"><a href="distributions.html#normal-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Normal distribution</a></li>
<li class="chapter" data-level="4.3.3" data-path="distributions.html"><a href="distributions.html#gamma-distribution"><i class="fa fa-check"></i><b>4.3.3</b> Gamma distribution</a></li>
<li class="chapter" data-level="4.3.4" data-path="distributions.html"><a href="distributions.html#cauchydistri"><i class="fa fa-check"></i><b>4.3.4</b> Cauchy distribution</a></li>
<li class="chapter" data-level="4.3.5" data-path="distributions.html"><a href="distributions.html#t-distribution"><i class="fa fa-check"></i><b>4.3.5</b> t-distribution</a></li>
<li class="chapter" data-level="4.3.6" data-path="distributions.html"><a href="distributions.html#f-distribution"><i class="fa fa-check"></i><b>4.3.6</b> F-distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rfunctions.html"><a href="rfunctions.html"><i class="fa fa-check"></i><b>5</b> Important R-functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rfunctions.html"><a href="rfunctions.html#data-preparation"><i class="fa fa-check"></i><b>5.1</b> Data preparation</a></li>
<li class="chapter" data-level="5.2" data-path="rfunctions.html"><a href="rfunctions.html#figures"><i class="fa fa-check"></i><b>5.2</b> Figures</a></li>
<li class="chapter" data-level="5.3" data-path="rfunctions.html"><a href="rfunctions.html#summary-1"><i class="fa fa-check"></i><b>5.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproducibleresearch.html"><a href="reproducibleresearch.html"><i class="fa fa-check"></i><b>6</b> Reproducible research</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reproducibleresearch.html"><a href="reproducibleresearch.html#summary-2"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
<li class="chapter" data-level="6.2" data-path="reproducibleresearch.html"><a href="reproducibleresearch.html#further-reading-2"><i class="fa fa-check"></i><b>6.2</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="furthertopics.html"><a href="furthertopics.html"><i class="fa fa-check"></i><b>7</b> Further topics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="furthertopics.html"><a href="furthertopics.html#bioacoustic-analyse"><i class="fa fa-check"></i><b>7.1</b> Bioacoustic analyse</a></li>
<li class="chapter" data-level="7.2" data-path="furthertopics.html"><a href="furthertopics.html#python"><i class="fa fa-check"></i><b>7.2</b> Python</a></li>
</ul></li>
<li class="part"><span><b>II BAYESIAN DATA ANALYSIS</b></span></li>
<li class="chapter" data-level="8" data-path="PART-II.html"><a href="PART-II.html"><i class="fa fa-check"></i><b>8</b> Introduction to PART II</a>
<ul>
<li class="chapter" data-level="" data-path="PART-II.html"><a href="PART-II.html#further-reading-3"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html"><i class="fa fa-check"></i><b>9</b> The Bayesian paradigm</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#introduction-1"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#summary-3"><i class="fa fa-check"></i><b>9.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="priors.html"><a href="priors.html"><i class="fa fa-check"></i><b>10</b> Prior distributions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="priors.html"><a href="priors.html#introduction-2"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="priors.html"><a href="priors.html#choosepriors"><i class="fa fa-check"></i><b>10.2</b> How to choose a prior</a></li>
<li class="chapter" data-level="10.3" data-path="priors.html"><a href="priors.html#prior-sensitivity"><i class="fa fa-check"></i><b>10.3</b> Prior sensitivity</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="lm.html"><a href="lm.html"><i class="fa fa-check"></i><b>11</b> Normal Linear Models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="lm.html"><a href="lm.html#linear-regression"><i class="fa fa-check"></i><b>11.1</b> Linear regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="lm.html"><a href="lm.html#background"><i class="fa fa-check"></i><b>11.1.1</b> Background</a></li>
<li class="chapter" data-level="11.1.2" data-path="lm.html"><a href="lm.html#fitting-a-linear-regression-in-r"><i class="fa fa-check"></i><b>11.1.2</b> Fitting a Linear Regression in R</a></li>
<li class="chapter" data-level="11.1.3" data-path="lm.html"><a href="lm.html#drawing-conclusions"><i class="fa fa-check"></i><b>11.1.3</b> Drawing Conclusions</a></li>
<li class="chapter" data-level="11.1.4" data-path="lm.html"><a href="lm.html#interpretation-of-the-r-summary-output"><i class="fa fa-check"></i><b>11.1.4</b> Interpretation of the R summary output</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="lm.html"><a href="lm.html#linear-model-with-one-categorical-predictor-one-way-anova"><i class="fa fa-check"></i><b>11.2</b> Linear model with one categorical predictor (one-way ANOVA)</a></li>
<li class="chapter" data-level="11.3" data-path="lm.html"><a href="lm.html#other-variants-of-normal-linear-models-two-way-anova-analysis-of-covariance-and-multiple-regression"><i class="fa fa-check"></i><b>11.3</b> Other variants of normal linear models: Two-way anova, analysis of covariance and multiple regression</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="lm.html"><a href="lm.html#linear-model-with-two-categorical-predictors-two-way-anova"><i class="fa fa-check"></i><b>11.3.1</b> Linear model with two categorical predictors (two-way ANOVA)</a></li>
<li class="chapter" data-level="11.3.2" data-path="lm.html"><a href="lm.html#a-linear-model-with-a-categorical-and-a-numeric-predictor-ancova"><i class="fa fa-check"></i><b>11.3.2</b> A linear model with a categorical and a numeric predictor (ANCOVA)</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="lm.html"><a href="lm.html#partial-coefficients-and-some-comments-on-collinearity"><i class="fa fa-check"></i><b>11.4</b> Partial coefficients and some comments on collinearity</a></li>
<li class="chapter" data-level="11.5" data-path="lm.html"><a href="lm.html#orderedfactors"><i class="fa fa-check"></i><b>11.5</b> Ordered Factors and Contrasts</a></li>
<li class="chapter" data-level="11.6" data-path="lm.html"><a href="lm.html#quadratic-and-higher-polynomial-terms"><i class="fa fa-check"></i><b>11.6</b> Quadratic and Higher Polynomial Terms</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="residualanalysis.html"><a href="residualanalysis.html"><i class="fa fa-check"></i><b>12</b> Assessing Model Assumptions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="residualanalysis.html"><a href="residualanalysis.html#model-assumptions"><i class="fa fa-check"></i><b>12.1</b> Model Assumptions</a></li>
<li class="chapter" data-level="12.2" data-path="residualanalysis.html"><a href="residualanalysis.html#independent-and-identically-distributed"><i class="fa fa-check"></i><b>12.2</b> Independent and Identically Distributed</a></li>
<li class="chapter" data-level="12.3" data-path="residualanalysis.html"><a href="residualanalysis.html#qqplot"><i class="fa fa-check"></i><b>12.3</b> The QQ-Plot</a></li>
<li class="chapter" data-level="12.4" data-path="residualanalysis.html"><a href="residualanalysis.html#tempautocorrelation"><i class="fa fa-check"></i><b>12.4</b> Temporal Autocorrelation</a></li>
<li class="chapter" data-level="12.5" data-path="residualanalysis.html"><a href="residualanalysis.html#spatialautocorrelation"><i class="fa fa-check"></i><b>12.5</b> Spatial Autocorrelation</a></li>
<li class="chapter" data-level="12.6" data-path="residualanalysis.html"><a href="residualanalysis.html#Heteroscedasticity"><i class="fa fa-check"></i><b>12.6</b> Heteroscedasticity</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lmer.html"><a href="lmer.html"><i class="fa fa-check"></i><b>13</b> Linear Mixed Effect Models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lmer.html"><a href="lmer.html#background-1"><i class="fa fa-check"></i><b>13.1</b> Background</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="lmer.html"><a href="lmer.html#why-mixed-effects-models"><i class="fa fa-check"></i><b>13.1.1</b> Why Mixed Effects Models?</a></li>
<li class="chapter" data-level="13.1.2" data-path="lmer.html"><a href="lmer.html#random-factors-and-partial-pooling"><i class="fa fa-check"></i><b>13.1.2</b> Random Factors and Partial Pooling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>14</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="glm.html"><a href="glm.html#introduction-3"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="glm.html"><a href="glm.html#summary-4"><i class="fa fa-check"></i><b>14.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="glmm.html"><a href="glmm.html"><i class="fa fa-check"></i><b>15</b> Generalized linear mixed models</a>
<ul>
<li class="chapter" data-level="15.1" data-path="glmm.html"><a href="glmm.html#introduction-4"><i class="fa fa-check"></i><b>15.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="glmm.html"><a href="glmm.html#binomial-mixed-model"><i class="fa fa-check"></i><b>15.1.1</b> Binomial Mixed Model</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="glmm.html"><a href="glmm.html#summary-5"><i class="fa fa-check"></i><b>15.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="modelchecking.html"><a href="modelchecking.html"><i class="fa fa-check"></i><b>16</b> Posterior predictive model checking</a>
<ul>
<li class="chapter" data-level="16.1" data-path="modelchecking.html"><a href="modelchecking.html#introduction-5"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="modelchecking.html"><a href="modelchecking.html#summary-6"><i class="fa fa-check"></i><b>16.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="model_comparison.html"><a href="model_comparison.html"><i class="fa fa-check"></i><b>17</b> Model comparison and multimodel inference</a>
<ul>
<li class="chapter" data-level="17.1" data-path="model_comparison.html"><a href="model_comparison.html#introduction-6"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="model_comparison.html"><a href="model_comparison.html#summary-7"><i class="fa fa-check"></i><b>17.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>18</b> MCMC using Stan</a>
<ul>
<li class="chapter" data-level="18.1" data-path="stan.html"><a href="stan.html#background-3"><i class="fa fa-check"></i><b>18.1</b> Background</a></li>
<li class="chapter" data-level="18.2" data-path="stan.html"><a href="stan.html#install-rstan"><i class="fa fa-check"></i><b>18.2</b> Install <code>rstan</code></a></li>
<li class="chapter" data-level="18.3" data-path="stan.html"><a href="stan.html#firststanmod"><i class="fa fa-check"></i><b>18.3</b> Writing a Stan model</a></li>
<li class="chapter" data-level="18.4" data-path="stan.html"><a href="stan.html#run-stan-from-r"><i class="fa fa-check"></i><b>18.4</b> Run Stan from R</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#further-reading-4"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="ridge_regression.html"><a href="ridge_regression.html"><i class="fa fa-check"></i><b>19</b> Ridge Regression</a>
<ul>
<li class="chapter" data-level="19.1" data-path="ridge_regression.html"><a href="ridge_regression.html#introduction-7"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="SEM.html"><a href="SEM.html"><i class="fa fa-check"></i><b>20</b> Structural equation models</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SEM.html"><a href="SEM.html#introduction-8"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="spatial_glmm.html"><a href="spatial_glmm.html"><i class="fa fa-check"></i><b>21</b> Modeling spatial data using GLMM</a>
<ul>
<li class="chapter" data-level="21.1" data-path="spatial_glmm.html"><a href="spatial_glmm.html#introduction-9"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="spatial_glmm.html"><a href="spatial_glmm.html#summary-8"><i class="fa fa-check"></i><b>21.2</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>III ECOLOGICAL MODELS</b></span></li>
<li class="chapter" data-level="22" data-path="PART-III.html"><a href="PART-III.html"><i class="fa fa-check"></i><b>22</b> Introduction to PART III</a>
<ul>
<li class="chapter" data-level="22.1" data-path="PART-III.html"><a href="PART-III.html#model-notations"><i class="fa fa-check"></i><b>22.1</b> Model notations</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html"><i class="fa fa-check"></i><b>23</b> Zero-inflated Poisson Mixed Model</a>
<ul>
<li class="chapter" data-level="23.1" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#introduction-10"><i class="fa fa-check"></i><b>23.1</b> Introduction</a></li>
<li class="chapter" data-level="23.2" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#example-data"><i class="fa fa-check"></i><b>23.2</b> Example data</a></li>
<li class="chapter" data-level="23.3" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#model"><i class="fa fa-check"></i><b>23.3</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="dailynestsurv.html"><a href="dailynestsurv.html"><i class="fa fa-check"></i><b>24</b> Daily nest survival</a>
<ul>
<li class="chapter" data-level="24.1" data-path="dailynestsurv.html"><a href="dailynestsurv.html#background-4"><i class="fa fa-check"></i><b>24.1</b> Background</a></li>
<li class="chapter" data-level="24.2" data-path="dailynestsurv.html"><a href="dailynestsurv.html#models-for-estimating-daily-nest-survival"><i class="fa fa-check"></i><b>24.2</b> Models for estimating daily nest survival</a></li>
<li class="chapter" data-level="24.3" data-path="dailynestsurv.html"><a href="dailynestsurv.html#known-fate-model"><i class="fa fa-check"></i><b>24.3</b> Known fate model</a></li>
<li class="chapter" data-level="24.4" data-path="dailynestsurv.html"><a href="dailynestsurv.html#dailynestsurvstan"><i class="fa fa-check"></i><b>24.4</b> The Stan model</a></li>
<li class="chapter" data-level="24.5" data-path="dailynestsurv.html"><a href="dailynestsurv.html#prepare-data-and-run-stan"><i class="fa fa-check"></i><b>24.5</b> Prepare data and run Stan</a></li>
<li class="chapter" data-level="24.6" data-path="dailynestsurv.html"><a href="dailynestsurv.html#check-convergence"><i class="fa fa-check"></i><b>24.6</b> Check convergence</a></li>
<li class="chapter" data-level="24.7" data-path="dailynestsurv.html"><a href="dailynestsurv.html#look-at-results"><i class="fa fa-check"></i><b>24.7</b> Look at results</a></li>
<li class="chapter" data-level="24.8" data-path="dailynestsurv.html"><a href="dailynestsurv.html#known-fate-model-for-irregular-nest-controls"><i class="fa fa-check"></i><b>24.8</b> Known fate model for irregular nest controls</a></li>
<li class="chapter" data-level="" data-path="dailynestsurv.html"><a href="dailynestsurv.html#further-reading-5"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html"><i class="fa fa-check"></i><b>25</b> Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals</a>
<ul>
<li class="chapter" data-level="25.1" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#introduction-11"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#data-description"><i class="fa fa-check"></i><b>25.2</b> Data description</a></li>
<li class="chapter" data-level="25.3" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#model-description"><i class="fa fa-check"></i><b>25.3</b> Model description</a></li>
<li class="chapter" data-level="25.4" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#the-stan-code"><i class="fa fa-check"></i><b>25.4</b> The Stan code</a></li>
<li class="chapter" data-level="25.5" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#call-stan-from-r-check-convergence-and-look-at-results"><i class="fa fa-check"></i><b>25.5</b> Call Stan from R, check convergence and look at results</a></li>
</ul></li>
<li class="part"><span><b>IV APPENDICES</b></span></li>
<li class="chapter" data-level="" data-path="referenzen.html"><a href="referenzen.html"><i class="fa fa-check"></i>Referenzen</a></li>
<li class="divider"></li>
</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis in Ecology with R and Stan</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cjs_with_mix" class="section level1 hasAnchor" number="25">
<h1><span class="header-section-number">25</span> Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals<a href="cjs_with_mix.html#cjs_with_mix" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-11" class="section level2 hasAnchor" number="25.1">
<h2><span class="header-section-number">25.1</span> Introduction<a href="cjs_with_mix.html#introduction-11" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In some species the identification of the sex is not possible for all individuals without sampling DNA. For example, morphological dimorphism is absent or so weak that parts of the individuals cannot be assigned to one of the sexes. Particularly in ornithological long-term capture recapture data sets that typically are obtained by voluntary bird ringers who do normaly not have the possibilities to analyse DNA, often the sex identification is missing in parts of the individuals. For estimating survival, it would nevertheless be valuable to include data of all individuals, use the information on sex-specific effects on survival wherever possible but account for the fact that of parts of the individuals the sex is not known. We here explain how a Cormack-Jolly-Seber model can be integrated with a mixture model in oder to allow for a combined analyses of individuals with and without sex identified.
An introduction to the Cormack-Jolly-Seber model we gave in Chapter 14.5 of the book <span class="citation">Korner-Nievergelt et al. (<a href="referenzen.html#ref-KornerNievergelt2015" role="doc-biblioref">2015</a>)</span>. We here expand this model by a mixture structure that allows including individuals with a missing categorical predictor variable, such as sex.</p>
</div>
<div id="data-description" class="section level2 hasAnchor" number="25.2">
<h2><span class="header-section-number">25.2</span> Data description<a href="cjs_with_mix.html#data-description" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="cjs_with_mix.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate data</span></span>
<span id="cb165-2"><a href="cjs_with_mix.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co"># true parameter values</span></span>
<span id="cb165-3"><a href="cjs_with_mix.html#cb165-3" aria-hidden="true" tabindex="-1"></a>theta  <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="co"># proportion of males</span></span>
<span id="cb165-4"><a href="cjs_with_mix.html#cb165-4" aria-hidden="true" tabindex="-1"></a>nocc <span class="ot">&lt;-</span> <span class="dv">15</span>    <span class="co"># number of years in the data set</span></span>
<span id="cb165-5"><a href="cjs_with_mix.html#cb165-5" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol=</span>nocc<span class="dv">-1</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb165-6"><a href="cjs_with_mix.html#cb165-6" aria-hidden="true" tabindex="-1"></a>b0[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>((nocc<span class="dv">-1</span>), <span class="dv">3</span>, <span class="dv">4</span>) <span class="co"># capture probability of males</span></span>
<span id="cb165-7"><a href="cjs_with_mix.html#cb165-7" aria-hidden="true" tabindex="-1"></a>b0[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>((nocc<span class="dv">-1</span>), <span class="dv">2</span>, <span class="dv">4</span>) <span class="co"># capture probability of females  </span></span>
<span id="cb165-8"><a href="cjs_with_mix.html#cb165-8" aria-hidden="true" tabindex="-1"></a>a0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb165-9"><a href="cjs_with_mix.html#cb165-9" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb165-10"><a href="cjs_with_mix.html#cb165-10" aria-hidden="true" tabindex="-1"></a>a0[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="fu">qlogis</span>(<span class="fl">0.7</span>) <span class="co"># average annual survival for adult males</span></span>
<span id="cb165-11"><a href="cjs_with_mix.html#cb165-11" aria-hidden="true" tabindex="-1"></a>a0[<span class="dv">1</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span> <span class="fu">qlogis</span>(<span class="fl">0.3</span>) <span class="co"># average annual survival for juveniles</span></span>
<span id="cb165-12"><a href="cjs_with_mix.html#cb165-12" aria-hidden="true" tabindex="-1"></a>a0[<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">qlogis</span>(<span class="fl">0.55</span>) <span class="co"># average annual survival for adult females</span></span>
<span id="cb165-13"><a href="cjs_with_mix.html#cb165-13" aria-hidden="true" tabindex="-1"></a>a0[<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> a0[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb165-14"><a href="cjs_with_mix.html#cb165-14" aria-hidden="true" tabindex="-1"></a>a1[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb165-15"><a href="cjs_with_mix.html#cb165-15" aria-hidden="true" tabindex="-1"></a>a1[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb165-16"><a href="cjs_with_mix.html#cb165-16" aria-hidden="true" tabindex="-1"></a>a1[<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.8</span></span>
<span id="cb165-17"><a href="cjs_with_mix.html#cb165-17" aria-hidden="true" tabindex="-1"></a>a1[<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> a1[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb165-18"><a href="cjs_with_mix.html#cb165-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-19"><a href="cjs_with_mix.html#cb165-19" aria-hidden="true" tabindex="-1"></a>nindi <span class="ot">&lt;-</span> <span class="dv">1000</span>    <span class="co"># number of individuals with identified sex</span></span>
<span id="cb165-20"><a href="cjs_with_mix.html#cb165-20" aria-hidden="true" tabindex="-1"></a>nindni <span class="ot">&lt;-</span> <span class="dv">1500</span>   <span class="co"># number of individuals with non-identified sex</span></span>
<span id="cb165-21"><a href="cjs_with_mix.html#cb165-21" aria-hidden="true" tabindex="-1"></a>nind <span class="ot">&lt;-</span> nindi <span class="sc">+</span> nindni  <span class="co"># total number of individuals</span></span>
<span id="cb165-22"><a href="cjs_with_mix.html#cb165-22" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol=</span>nocc, <span class="at">nrow=</span>nind)</span>
<span id="cb165-23"><a href="cjs_with_mix.html#cb165-23" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol=</span>nocc, <span class="at">nrow=</span>nind)</span>
<span id="cb165-24"><a href="cjs_with_mix.html#cb165-24" aria-hidden="true" tabindex="-1"></a>first <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>(nocc<span class="dv">-1</span>), nind, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb165-25"><a href="cjs_with_mix.html#cb165-25" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), nind, <span class="at">prob=</span><span class="fu">c</span>(theta, <span class="dv">1</span><span class="sc">-</span>theta), <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb165-26"><a href="cjs_with_mix.html#cb165-26" aria-hidden="true" tabindex="-1"></a>juvfirst <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), nind, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb165-27"><a href="cjs_with_mix.html#cb165-27" aria-hidden="true" tabindex="-1"></a>juv <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>nind, <span class="at">ncol=</span>nocc)</span>
<span id="cb165-28"><a href="cjs_with_mix.html#cb165-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nind) juv[i,first[i]] <span class="ot">&lt;-</span> juv[i]</span>
<span id="cb165-29"><a href="cjs_with_mix.html#cb165-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-30"><a href="cjs_with_mix.html#cb165-30" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(nocc<span class="dv">-1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)                   <span class="co"># a time dependent covariate covariate </span></span>
<span id="cb165-31"><a href="cjs_with_mix.html#cb165-31" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> b0                                     <span class="co"># recapture probability</span></span>
<span id="cb165-32"><a href="cjs_with_mix.html#cb165-32" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, nocc<span class="dv">-1</span>))</span>
<span id="cb165-33"><a href="cjs_with_mix.html#cb165-33" aria-hidden="true" tabindex="-1"></a><span class="co"># for ad males</span></span>
<span id="cb165-34"><a href="cjs_with_mix.html#cb165-34" aria-hidden="true" tabindex="-1"></a>phi[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(a0[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span>a1[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">*</span>x)</span>
<span id="cb165-35"><a href="cjs_with_mix.html#cb165-35" aria-hidden="true" tabindex="-1"></a><span class="co"># for ad females</span></span>
<span id="cb165-36"><a href="cjs_with_mix.html#cb165-36" aria-hidden="true" tabindex="-1"></a>phi[<span class="dv">2</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(a0[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">+</span>a1[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">*</span>x)</span>
<span id="cb165-37"><a href="cjs_with_mix.html#cb165-37" aria-hidden="true" tabindex="-1"></a><span class="co"># for juvs</span></span>
<span id="cb165-38"><a href="cjs_with_mix.html#cb165-38" aria-hidden="true" tabindex="-1"></a>phi[<span class="dv">1</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span>  phi[<span class="dv">2</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(a0[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">+</span>a1[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">*</span>x)</span>
<span id="cb165-39"><a href="cjs_with_mix.html#cb165-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nind){</span>
<span id="cb165-40"><a href="cjs_with_mix.html#cb165-40" aria-hidden="true" tabindex="-1"></a>  z[i,first[i]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb165-41"><a href="cjs_with_mix.html#cb165-41" aria-hidden="true" tabindex="-1"></a>  y[i, first[i]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb165-42"><a href="cjs_with_mix.html#cb165-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(t <span class="cf">in</span> (first[i]<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nocc){</span>
<span id="cb165-43"><a href="cjs_with_mix.html#cb165-43" aria-hidden="true" tabindex="-1"></a>    z[i, t] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>z[i,t<span class="dv">-1</span>]<span class="sc">*</span>phi[sex[i],juv[i,t<span class="dv">-1</span>]<span class="sc">+</span><span class="dv">1</span>, t<span class="dv">-1</span>])</span>
<span id="cb165-44"><a href="cjs_with_mix.html#cb165-44" aria-hidden="true" tabindex="-1"></a>    y[i, t] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>z[i,t]<span class="sc">*</span>p[sex[i],t<span class="dv">-1</span>])</span>
<span id="cb165-45"><a href="cjs_with_mix.html#cb165-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb165-46"><a href="cjs_with_mix.html#cb165-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb165-47"><a href="cjs_with_mix.html#cb165-47" aria-hidden="true" tabindex="-1"></a>y[<span class="fu">is.na</span>(y)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>The mark-recapture data set consists of capture histories of 2500 individuals over 15 time periods. For each time period <span class="math inline">\(t\)</span> and individual <span class="math inline">\(i\)</span> the capture history matrix <span class="math inline">\(y\)</span> contains <span class="math inline">\(y_{it}=1\)</span> if the individual <span class="math inline">\(i\)</span> is captured during time period <span class="math inline">\(t\)</span>, or <span class="math inline">\(y_{it}=0\)</span> if the individual <span class="math inline">\(i\)</span> is not captured during time period <span class="math inline">\(t\)</span>. The marking time period varies between individuals from 1 to 14. At the marking time period, the age of the individuals was classified either as juvenile or as adult. Juveniles turn into adults after one time period, thus age is known for all individuals during all time periods after marking. For 1000 individuals of the 2500 individuals, the sex is identified, whereas for 1500 individuals, the sex is unknown. The example data contain one covariate <span class="math inline">\(x\)</span> that takes on one value for each time period.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="cjs_with_mix.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bundle the data for Stan</span></span>
<span id="cb166-2"><a href="cjs_with_mix.html#cb166-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>nindi</span>
<span id="cb166-3"><a href="cjs_with_mix.html#cb166-3" aria-hidden="true" tabindex="-1"></a>ni <span class="ot">&lt;-</span> (nindi<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nind</span>
<span id="cb166-4"><a href="cjs_with_mix.html#cb166-4" aria-hidden="true" tabindex="-1"></a>datax <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">yi=</span>y[i,], <span class="at">nindi=</span>nindi, <span class="at">sex=</span>sex[i], <span class="at">nocc=</span>nocc, </span>
<span id="cb166-5"><a href="cjs_with_mix.html#cb166-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">yni=</span>y[ni,], <span class="at">nindni=</span>nindni, <span class="at">firsti=</span>first[i], <span class="at">firstni=</span>first[ni],</span>
<span id="cb166-6"><a href="cjs_with_mix.html#cb166-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">juvi=</span>juv[i,]<span class="sc">+</span><span class="dv">1</span>, <span class="at">juvni=</span>juv[ni,]<span class="sc">+</span><span class="dv">1</span>, <span class="at">year=</span><span class="dv">1</span><span class="sc">:</span>nocc, <span class="at">x=</span>x)</span></code></pre></div>
</div>
<div id="model-description" class="section level2 hasAnchor" number="25.3">
<h2><span class="header-section-number">25.3</span> Model description<a href="cjs_with_mix.html#model-description" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The observations <span class="math inline">\(y_{it}\)</span>, an indicator of whether individual i was recaptured during time period <span class="math inline">\(t\)</span> is modelled conditional on the latent true state of the individual birds <span class="math inline">\(z_{it}\)</span> (0 = dead or permanently emigrated, 1 = alive and at the study site) as a Bernoulli variable. The probability <span class="math inline">\(P(y_{it} = 1)\)</span> is the product of the probability that an alive individual is recaptured, <span class="math inline">\(p_{it}\)</span>, and the state of the bird <span class="math inline">\(z_{it}\)</span> (alive = 1, dead = 0). Thus, a dead bird cannot be recaptured, whereas for a bird alive during time period <span class="math inline">\(t\)</span>, the recapture probability equals <span class="math inline">\(p_{it}\)</span>:
<span class="math display">\[y_{it} \sim Bernoulli(z_{it}p_{it})\]</span>
The latent state variable <span class="math inline">\(z_{it}\)</span> is a Markovian variable with the state at time <span class="math inline">\(t\)</span> being dependent on the state at time <span class="math inline">\(t-1\)</span> and the apparent survival probability <span class="math display">\[\phi_{it}\]</span>:
<span class="math display">\[z_{it} \sim Bernoulli(z_{it-1}\phi_{it})\]</span>
We use the term apparent survival in order to indicate that the parameter <span class="math inline">\(\phi\)</span> is a product of site fidelity and survival. Thus, individuals that permanently emigrated from the study area cannot be distinguished from dead individuals.
In both models, the parameters <span class="math inline">\(\phi\)</span> and <span class="math inline">\(p\)</span> were modelled as sex-specific. However, for parts of the individuals, sex could not be identified, i.e. sex was missing. Ignoring these missing values would most likely lead to a bias because they were not missing at random. The probability that sex can be identified is increasing with age and most likely differs between sexes. Therefore, we included a mixture model for the sex:
<span class="math display">\[Sex_i \sim Categorical(q_i)\]</span>
where <span class="math inline">\(q_i\)</span> is a vector of length 2, containing the probability of being a male and a female, respectively. In this way, the sex of the non-identified individuals was assumed to be male or female with probability <span class="math inline">\(q[1]\)</span> and <span class="math inline">\(q[2]=1-q[1]\)</span>, respectively. This model corresponds to the finite mixture model introduced by <span class="citation">Pledger, Pollock, and Norris (<a href="referenzen.html#ref-Pledger2003" role="doc-biblioref">2003</a>)</span> in order to account for unknown classes of birds (heterogeneity). However, in our case, for parts of the individuals the class (sex) was known.</p>
<p>In the example model, we constrain apparent survival to be linearly dependent on a covariate x with different slopes for males, females and juveniles using the logit link function.
<span class="math display">\[logit(\phi_{it}) = a0_{sex-age-class[it]} + a1_{sex-age-class[it]}x_i\]</span></p>
<p>Annual recapture probability was modelled for each year and age and sex class independently:
<span class="math display">\[p_{it} = b0_{t,sex-age-class[it]}\]</span>
Uniform prior distributions were used for all parameters with a parameter space limited to values between 0 and 1 (probabilities) and a normal distribution with a mean of 0 and a standard deviation of 1.5 for the intercept <span class="math inline">\(a0\)</span>, and a standard deviation of 5 was used for <span class="math inline">\(a1\)</span>.</p>
</div>
<div id="the-stan-code" class="section level2 hasAnchor" number="25.4">
<h2><span class="header-section-number">25.4</span> The Stan code<a href="cjs_with_mix.html#the-stan-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The trick for coding the CMR-mixture model in Stan is to formulate the model 3 times:<br />
1. For the individuals with identified sex<br />
2. For the males that were not identified<br />
3. For the females that were not identified</p>
<p>Then for the non-identified individuals a mixture model is formulated that assigns a probability of being a female or a male to each individual.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb167-1"><a href="cjs_with_mix.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb167-2"><a href="cjs_with_mix.html#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">2</span>&gt; nocc;                    <span class="co">// number of capture events</span></span>
<span id="cb167-3"><a href="cjs_with_mix.html#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; nindi;                   <span class="co">// number of individuals with identified sex</span></span>
<span id="cb167-4"><a href="cjs_with_mix.html#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; nindni;                  <span class="co">// number of individuals with non-identified sex</span></span>
<span id="cb167-5"><a href="cjs_with_mix.html#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">2</span>&gt; yi[nindi,nocc];         <span class="co">// CH[i,k]: individual i captured at k</span></span>
<span id="cb167-6"><a href="cjs_with_mix.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=nocc<span class="dv">-1</span>&gt; firsti[nindi];      <span class="co">// year of first capture</span></span>
<span id="cb167-7"><a href="cjs_with_mix.html#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">2</span>&gt; yni[nindni,nocc];       <span class="co">// CH[i,k]: individual i captured at k</span></span>
<span id="cb167-8"><a href="cjs_with_mix.html#cb167-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=nocc<span class="dv">-1</span>&gt; firstni[nindni];    <span class="co">// year of first capture</span></span>
<span id="cb167-9"><a href="cjs_with_mix.html#cb167-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=<span class="dv">2</span>&gt; sex[nindi];</span>
<span id="cb167-10"><a href="cjs_with_mix.html#cb167-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=<span class="dv">2</span>&gt; juvi[nindi, nocc];</span>
<span id="cb167-11"><a href="cjs_with_mix.html#cb167-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=<span class="dv">2</span>&gt; juvni[nindni, nocc];</span>
<span id="cb167-12"><a href="cjs_with_mix.html#cb167-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; year[nocc];</span>
<span id="cb167-13"><a href="cjs_with_mix.html#cb167-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> x[nocc<span class="dv">-1</span>];                     <span class="co">// a covariate </span></span>
<span id="cb167-14"><a href="cjs_with_mix.html#cb167-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-15"><a href="cjs_with_mix.html#cb167-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-16"><a href="cjs_with_mix.html#cb167-16" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb167-17"><a href="cjs_with_mix.html#cb167-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=nocc+<span class="dv">1</span>&gt; lasti[nindi];       <span class="co">// last[i]:  ind i last capture</span></span>
<span id="cb167-18"><a href="cjs_with_mix.html#cb167-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=nocc+<span class="dv">1</span>&gt; lastni[nindni];       <span class="co">// last[i]:  ind i last capture</span></span>
<span id="cb167-19"><a href="cjs_with_mix.html#cb167-19" aria-hidden="true" tabindex="-1"></a>  lasti = rep_array(<span class="dv">0</span>,nindi); </span>
<span id="cb167-20"><a href="cjs_with_mix.html#cb167-20" aria-hidden="true" tabindex="-1"></a>  lastni = rep_array(<span class="dv">0</span>,nindni);</span>
<span id="cb167-21"><a href="cjs_with_mix.html#cb167-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:nindi) {</span>
<span id="cb167-22"><a href="cjs_with_mix.html#cb167-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> firsti[i]:nocc) {</span>
<span id="cb167-23"><a href="cjs_with_mix.html#cb167-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (yi[i,k] == <span class="dv">1</span>) {</span>
<span id="cb167-24"><a href="cjs_with_mix.html#cb167-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (k &gt; lasti[i])  lasti[i] = k;</span>
<span id="cb167-25"><a href="cjs_with_mix.html#cb167-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-26"><a href="cjs_with_mix.html#cb167-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb167-27"><a href="cjs_with_mix.html#cb167-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb167-28"><a href="cjs_with_mix.html#cb167-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span>:nindni) {</span>
<span id="cb167-29"><a href="cjs_with_mix.html#cb167-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (kk <span class="cf">in</span> firstni[ii]:nocc) {</span>
<span id="cb167-30"><a href="cjs_with_mix.html#cb167-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (yni[ii,kk] == <span class="dv">1</span>) {</span>
<span id="cb167-31"><a href="cjs_with_mix.html#cb167-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (kk &gt; lastni[ii])  lastni[ii] = kk;</span>
<span id="cb167-32"><a href="cjs_with_mix.html#cb167-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-33"><a href="cjs_with_mix.html#cb167-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb167-34"><a href="cjs_with_mix.html#cb167-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb167-35"><a href="cjs_with_mix.html#cb167-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-36"><a href="cjs_with_mix.html#cb167-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-37"><a href="cjs_with_mix.html#cb167-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-38"><a href="cjs_with_mix.html#cb167-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-39"><a href="cjs_with_mix.html#cb167-39" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb167-40"><a href="cjs_with_mix.html#cb167-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; theta[nindni];            <span class="co">// probability of being male for non-identified individuals</span></span>
<span id="cb167-41"><a href="cjs_with_mix.html#cb167-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; b0[<span class="dv">2</span>,nocc<span class="dv">-1</span>];             <span class="co">// intercept of p</span></span>
<span id="cb167-42"><a href="cjs_with_mix.html#cb167-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> a0[<span class="dv">2</span>,<span class="dv">2</span>];                  <span class="co">// intercept for phi </span></span>
<span id="cb167-43"><a href="cjs_with_mix.html#cb167-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> a1[<span class="dv">2</span>,<span class="dv">2</span>];                  <span class="co">// coefficient for phi   </span></span>
<span id="cb167-44"><a href="cjs_with_mix.html#cb167-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-45"><a href="cjs_with_mix.html#cb167-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-46"><a href="cjs_with_mix.html#cb167-46" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb167-47"><a href="cjs_with_mix.html#cb167-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;p_male[nindni,nocc];         <span class="co">// capture probability</span></span>
<span id="cb167-48"><a href="cjs_with_mix.html#cb167-48" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;p_female[nindni,nocc];       <span class="co">// capture probability</span></span>
<span id="cb167-49"><a href="cjs_with_mix.html#cb167-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;p[nindi,nocc];               <span class="co">// capture probability</span></span>
<span id="cb167-50"><a href="cjs_with_mix.html#cb167-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-51"><a href="cjs_with_mix.html#cb167-51" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;phi_male[nindni,nocc<span class="dv">-1</span>];   <span class="co">// survival probability</span></span>
<span id="cb167-52"><a href="cjs_with_mix.html#cb167-52" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;chi_male[nindni,nocc+<span class="dv">1</span>];   <span class="co">// probability that an individual </span></span>
<span id="cb167-53"><a href="cjs_with_mix.html#cb167-53" aria-hidden="true" tabindex="-1"></a>                                                  <span class="co">// is never recaptured after its</span></span>
<span id="cb167-54"><a href="cjs_with_mix.html#cb167-54" aria-hidden="true" tabindex="-1"></a>                                                  <span class="co">// last capture</span></span>
<span id="cb167-55"><a href="cjs_with_mix.html#cb167-55" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;phi_female[nindni,nocc<span class="dv">-1</span>]; <span class="co">// survival probability</span></span>
<span id="cb167-56"><a href="cjs_with_mix.html#cb167-56" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;chi_female[nindni,nocc+<span class="dv">1</span>]; <span class="co">// probability that an individual </span></span>
<span id="cb167-57"><a href="cjs_with_mix.html#cb167-57" aria-hidden="true" tabindex="-1"></a>                                                  <span class="co">// is never recaptured after its</span></span>
<span id="cb167-58"><a href="cjs_with_mix.html#cb167-58" aria-hidden="true" tabindex="-1"></a>                                                   <span class="co">// last capture</span></span>
<span id="cb167-59"><a href="cjs_with_mix.html#cb167-59" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;phi[nindi,nocc<span class="dv">-1</span>];   <span class="co">// survival probability</span></span>
<span id="cb167-60"><a href="cjs_with_mix.html#cb167-60" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;chi[nindi,nocc+<span class="dv">1</span>];   <span class="co">// probability that an individual </span></span>
<span id="cb167-61"><a href="cjs_with_mix.html#cb167-61" aria-hidden="true" tabindex="-1"></a>                                           <span class="co">// is never recaptured after its</span></span>
<span id="cb167-62"><a href="cjs_with_mix.html#cb167-62" aria-hidden="true" tabindex="-1"></a>                                           <span class="co">// last capture</span></span>
<span id="cb167-63"><a href="cjs_with_mix.html#cb167-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-64"><a href="cjs_with_mix.html#cb167-64" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb167-65"><a href="cjs_with_mix.html#cb167-65" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> k; </span>
<span id="cb167-66"><a href="cjs_with_mix.html#cb167-66" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> kk; </span>
<span id="cb167-67"><a href="cjs_with_mix.html#cb167-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span>:nindi){</span>
<span id="cb167-68"><a href="cjs_with_mix.html#cb167-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (firsti[ii]&gt;<span class="dv">1</span>) {</span>
<span id="cb167-69"><a href="cjs_with_mix.html#cb167-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (z <span class="cf">in</span> <span class="dv">1</span>:(firsti[ii]-<span class="dv">1</span>)){</span>
<span id="cb167-70"><a href="cjs_with_mix.html#cb167-70" aria-hidden="true" tabindex="-1"></a>          phi[ii,z] = <span class="dv">1</span>;</span>
<span id="cb167-71"><a href="cjs_with_mix.html#cb167-71" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-72"><a href="cjs_with_mix.html#cb167-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-73"><a href="cjs_with_mix.html#cb167-73" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(tt <span class="cf">in</span> firsti[ii]:(nocc<span class="dv">-1</span>)) {</span>
<span id="cb167-74"><a href="cjs_with_mix.html#cb167-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">// linear predictor for phi:</span></span>
<span id="cb167-75"><a href="cjs_with_mix.html#cb167-75" aria-hidden="true" tabindex="-1"></a>        phi[ii,tt] = inv_logit(a0[sex[ii], juvi[ii,tt]] + a1[sex[ii], juvi[ii,tt]]*x[tt]); </span>
<span id="cb167-76"><a href="cjs_with_mix.html#cb167-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-77"><a href="cjs_with_mix.html#cb167-77" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-78"><a href="cjs_with_mix.html#cb167-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb167-79"><a href="cjs_with_mix.html#cb167-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-80"><a href="cjs_with_mix.html#cb167-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span>:nindni){</span>
<span id="cb167-81"><a href="cjs_with_mix.html#cb167-81" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (firstni[ii]&gt;<span class="dv">1</span>) {</span>
<span id="cb167-82"><a href="cjs_with_mix.html#cb167-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (z <span class="cf">in</span> <span class="dv">1</span>:(firstni[ii]-<span class="dv">1</span>)){</span>
<span id="cb167-83"><a href="cjs_with_mix.html#cb167-83" aria-hidden="true" tabindex="-1"></a>          phi_female[ii,z] = <span class="dv">1</span>;</span>
<span id="cb167-84"><a href="cjs_with_mix.html#cb167-84" aria-hidden="true" tabindex="-1"></a>          phi_male[ii,z] = <span class="dv">1</span>;</span>
<span id="cb167-85"><a href="cjs_with_mix.html#cb167-85" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-86"><a href="cjs_with_mix.html#cb167-86" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-87"><a href="cjs_with_mix.html#cb167-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(tt <span class="cf">in</span> firstni[ii]:(nocc<span class="dv">-1</span>)) {</span>
<span id="cb167-88"><a href="cjs_with_mix.html#cb167-88" aria-hidden="true" tabindex="-1"></a>        <span class="co">// linear predictor for phi:</span></span>
<span id="cb167-89"><a href="cjs_with_mix.html#cb167-89" aria-hidden="true" tabindex="-1"></a>        phi_male[ii,tt] = inv_logit(a0[<span class="dv">1</span>, juvni[ii,tt]] + a1[<span class="dv">1</span>, juvni[ii,tt]]*x[tt]); </span>
<span id="cb167-90"><a href="cjs_with_mix.html#cb167-90" aria-hidden="true" tabindex="-1"></a>        phi_female[ii,tt] = inv_logit(a0[<span class="dv">2</span>, juvni[ii,tt]]+ a1[<span class="dv">2</span>, juvni[ii,tt]]*x[tt]);</span>
<span id="cb167-91"><a href="cjs_with_mix.html#cb167-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-92"><a href="cjs_with_mix.html#cb167-92" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-93"><a href="cjs_with_mix.html#cb167-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb167-94"><a href="cjs_with_mix.html#cb167-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb167-95"><a href="cjs_with_mix.html#cb167-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:nindi) {</span>
<span id="cb167-96"><a href="cjs_with_mix.html#cb167-96" aria-hidden="true" tabindex="-1"></a>      <span class="co">// linear predictor for p for identified individuals</span></span>
<span id="cb167-97"><a href="cjs_with_mix.html#cb167-97" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(w <span class="cf">in</span> <span class="dv">1</span>:firsti[i]){</span>
<span id="cb167-98"><a href="cjs_with_mix.html#cb167-98" aria-hidden="true" tabindex="-1"></a>        p[i,w] = <span class="dv">1</span>;</span>
<span id="cb167-99"><a href="cjs_with_mix.html#cb167-99" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-100"><a href="cjs_with_mix.html#cb167-100" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(kkk <span class="cf">in</span> (firsti[i]+<span class="dv">1</span>):nocc)</span>
<span id="cb167-101"><a href="cjs_with_mix.html#cb167-101" aria-hidden="true" tabindex="-1"></a>        p[i,kkk] = b0[sex[i],year[kkk<span class="dv">-1</span>]];  </span>
<span id="cb167-102"><a href="cjs_with_mix.html#cb167-102" aria-hidden="true" tabindex="-1"></a>      chi[i,nocc+<span class="dv">1</span>] = <span class="fl">1.0</span>;              </span>
<span id="cb167-103"><a href="cjs_with_mix.html#cb167-103" aria-hidden="true" tabindex="-1"></a>      k = nocc;</span>
<span id="cb167-104"><a href="cjs_with_mix.html#cb167-104" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (k &gt; firsti[i]) {</span>
<span id="cb167-105"><a href="cjs_with_mix.html#cb167-105" aria-hidden="true" tabindex="-1"></a>        chi[i,k] = (<span class="dv">1</span> - phi[i,k<span class="dv">-1</span>]) + phi[i,k<span class="dv">-1</span>] * (<span class="dv">1</span> - p[i,k]) * chi[i,k+<span class="dv">1</span>]; </span>
<span id="cb167-106"><a href="cjs_with_mix.html#cb167-106" aria-hidden="true" tabindex="-1"></a>        k = k - <span class="dv">1</span>;</span>
<span id="cb167-107"><a href="cjs_with_mix.html#cb167-107" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-108"><a href="cjs_with_mix.html#cb167-108" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (firsti[i]&gt;<span class="dv">1</span>) {</span>
<span id="cb167-109"><a href="cjs_with_mix.html#cb167-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (u <span class="cf">in</span> <span class="dv">1</span>:(firsti[i]-<span class="dv">1</span>)){</span>
<span id="cb167-110"><a href="cjs_with_mix.html#cb167-110" aria-hidden="true" tabindex="-1"></a>          chi[i,u] = <span class="dv">0</span>;</span>
<span id="cb167-111"><a href="cjs_with_mix.html#cb167-111" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-112"><a href="cjs_with_mix.html#cb167-112" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-113"><a href="cjs_with_mix.html#cb167-113" aria-hidden="true" tabindex="-1"></a>      chi[i,firsti[i]] = (<span class="dv">1</span> - p[i,firsti[i]]) * chi[i,firsti[i]+<span class="dv">1</span>];</span>
<span id="cb167-114"><a href="cjs_with_mix.html#cb167-114" aria-hidden="true" tabindex="-1"></a>    }<span class="co">// close definition of transformed parameters for identified individuals</span></span>
<span id="cb167-115"><a href="cjs_with_mix.html#cb167-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-116"><a href="cjs_with_mix.html#cb167-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:nindni) {</span>
<span id="cb167-117"><a href="cjs_with_mix.html#cb167-117" aria-hidden="true" tabindex="-1"></a>      <span class="co">// linear predictor for p for non-identified individuals</span></span>
<span id="cb167-118"><a href="cjs_with_mix.html#cb167-118" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(w <span class="cf">in</span> <span class="dv">1</span>:firstni[i]){</span>
<span id="cb167-119"><a href="cjs_with_mix.html#cb167-119" aria-hidden="true" tabindex="-1"></a>        p_male[i,w] = <span class="dv">1</span>;</span>
<span id="cb167-120"><a href="cjs_with_mix.html#cb167-120" aria-hidden="true" tabindex="-1"></a>        p_female[i,w] = <span class="dv">1</span>;</span>
<span id="cb167-121"><a href="cjs_with_mix.html#cb167-121" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-122"><a href="cjs_with_mix.html#cb167-122" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(kkkk <span class="cf">in</span> (firstni[i]+<span class="dv">1</span>):nocc){</span>
<span id="cb167-123"><a href="cjs_with_mix.html#cb167-123" aria-hidden="true" tabindex="-1"></a>        p_male[i,kkkk] = b0[<span class="dv">1</span>,year[kkkk<span class="dv">-1</span>]];  </span>
<span id="cb167-124"><a href="cjs_with_mix.html#cb167-124" aria-hidden="true" tabindex="-1"></a>        p_female[i,kkkk] = b0[<span class="dv">2</span>,year[kkkk<span class="dv">-1</span>]];</span>
<span id="cb167-125"><a href="cjs_with_mix.html#cb167-125" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-126"><a href="cjs_with_mix.html#cb167-126" aria-hidden="true" tabindex="-1"></a>      chi_male[i,nocc+<span class="dv">1</span>] = <span class="fl">1.0</span>; </span>
<span id="cb167-127"><a href="cjs_with_mix.html#cb167-127" aria-hidden="true" tabindex="-1"></a>      chi_female[i,nocc+<span class="dv">1</span>] = <span class="fl">1.0</span>; </span>
<span id="cb167-128"><a href="cjs_with_mix.html#cb167-128" aria-hidden="true" tabindex="-1"></a>      k = nocc;</span>
<span id="cb167-129"><a href="cjs_with_mix.html#cb167-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (k &gt; firstni[i]) {</span>
<span id="cb167-130"><a href="cjs_with_mix.html#cb167-130" aria-hidden="true" tabindex="-1"></a>        chi_male[i,k] = (<span class="dv">1</span> - phi_male[i,k<span class="dv">-1</span>]) + phi_male[i,k<span class="dv">-1</span>] * (<span class="dv">1</span> - p_male[i,k]) * chi_male[i,k+<span class="dv">1</span>]; </span>
<span id="cb167-131"><a href="cjs_with_mix.html#cb167-131" aria-hidden="true" tabindex="-1"></a>        chi_female[i,k] = (<span class="dv">1</span> - phi_female[i,k<span class="dv">-1</span>]) + phi_female[i,k<span class="dv">-1</span>] * (<span class="dv">1</span> - p_female[i,k]) * chi_female[i,k+<span class="dv">1</span>]; </span>
<span id="cb167-132"><a href="cjs_with_mix.html#cb167-132" aria-hidden="true" tabindex="-1"></a>        k = k - <span class="dv">1</span>;</span>
<span id="cb167-133"><a href="cjs_with_mix.html#cb167-133" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-134"><a href="cjs_with_mix.html#cb167-134" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (firstni[i]&gt;<span class="dv">1</span>) {</span>
<span id="cb167-135"><a href="cjs_with_mix.html#cb167-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (u <span class="cf">in</span> <span class="dv">1</span>:(firstni[i]-<span class="dv">1</span>)){</span>
<span id="cb167-136"><a href="cjs_with_mix.html#cb167-136" aria-hidden="true" tabindex="-1"></a>          chi_male[i,u] = <span class="dv">0</span>;</span>
<span id="cb167-137"><a href="cjs_with_mix.html#cb167-137" aria-hidden="true" tabindex="-1"></a>          chi_female[i,u] = <span class="dv">0</span>;</span>
<span id="cb167-138"><a href="cjs_with_mix.html#cb167-138" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-139"><a href="cjs_with_mix.html#cb167-139" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-140"><a href="cjs_with_mix.html#cb167-140" aria-hidden="true" tabindex="-1"></a>      chi_male[i,firstni[i]] = (<span class="dv">1</span> - p_male[i,firstni[i]]) * chi_male[i,firstni[i]+<span class="dv">1</span>];</span>
<span id="cb167-141"><a href="cjs_with_mix.html#cb167-141" aria-hidden="true" tabindex="-1"></a>      chi_female[i,firstni[i]] = (<span class="dv">1</span> - p_female[i,firstni[i]]) * chi_female[i,firstni[i]+<span class="dv">1</span>];</span>
<span id="cb167-142"><a href="cjs_with_mix.html#cb167-142" aria-hidden="true" tabindex="-1"></a>    } <span class="co">// close definition of transformed parameters for non-identified individuals</span></span>
<span id="cb167-143"><a href="cjs_with_mix.html#cb167-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-144"><a href="cjs_with_mix.html#cb167-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb167-145"><a href="cjs_with_mix.html#cb167-145" aria-hidden="true" tabindex="-1"></a>  }  <span class="co">// close block of transformed parameters exclusive parameter declarations</span></span>
<span id="cb167-146"><a href="cjs_with_mix.html#cb167-146" aria-hidden="true" tabindex="-1"></a>}    <span class="co">// close transformed parameters</span></span>
<span id="cb167-147"><a href="cjs_with_mix.html#cb167-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-148"><a href="cjs_with_mix.html#cb167-148" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb167-149"><a href="cjs_with_mix.html#cb167-149" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb167-150"><a href="cjs_with_mix.html#cb167-150" aria-hidden="true" tabindex="-1"></a>  theta ~ beta(<span class="dv">1</span>, <span class="dv">1</span>);</span>
<span id="cb167-151"><a href="cjs_with_mix.html#cb167-151" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span>:(nocc<span class="dv">-1</span>)){</span>
<span id="cb167-152"><a href="cjs_with_mix.html#cb167-152" aria-hidden="true" tabindex="-1"></a>    b0[<span class="dv">1</span>,g]~beta(<span class="dv">1</span>,<span class="dv">1</span>);</span>
<span id="cb167-153"><a href="cjs_with_mix.html#cb167-153" aria-hidden="true" tabindex="-1"></a>    b0[<span class="dv">2</span>,g]~beta(<span class="dv">1</span>,<span class="dv">1</span>);</span>
<span id="cb167-154"><a href="cjs_with_mix.html#cb167-154" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb167-155"><a href="cjs_with_mix.html#cb167-155" aria-hidden="true" tabindex="-1"></a>  a0[<span class="dv">1</span>,<span class="dv">1</span>]~normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb167-156"><a href="cjs_with_mix.html#cb167-156" aria-hidden="true" tabindex="-1"></a>  a0[<span class="dv">1</span>,<span class="dv">2</span>]~normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb167-157"><a href="cjs_with_mix.html#cb167-157" aria-hidden="true" tabindex="-1"></a>  a1[<span class="dv">1</span>,<span class="dv">1</span>]~normal(<span class="dv">0</span>,<span class="dv">3</span>);</span>
<span id="cb167-158"><a href="cjs_with_mix.html#cb167-158" aria-hidden="true" tabindex="-1"></a>  a1[<span class="dv">1</span>,<span class="dv">2</span>]~normal(<span class="dv">0</span>,<span class="dv">3</span>);</span>
<span id="cb167-159"><a href="cjs_with_mix.html#cb167-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-160"><a href="cjs_with_mix.html#cb167-160" aria-hidden="true" tabindex="-1"></a>  a0[<span class="dv">2</span>,<span class="dv">1</span>]~normal(<span class="dv">0</span>,<span class="fl">1.5</span>);</span>
<span id="cb167-161"><a href="cjs_with_mix.html#cb167-161" aria-hidden="true" tabindex="-1"></a>  a0[<span class="dv">2</span>,<span class="dv">2</span>]~normal(a0[<span class="dv">1</span>,<span class="dv">2</span>],<span class="fl">0.01</span>); <span class="co">// for juveniles, we assume that the effect of the covariate is independet of sex</span></span>
<span id="cb167-162"><a href="cjs_with_mix.html#cb167-162" aria-hidden="true" tabindex="-1"></a>  a1[<span class="dv">2</span>,<span class="dv">1</span>]~normal(<span class="dv">0</span>,<span class="dv">3</span>);</span>
<span id="cb167-163"><a href="cjs_with_mix.html#cb167-163" aria-hidden="true" tabindex="-1"></a>  a1[<span class="dv">2</span>,<span class="dv">2</span>]~normal(a1[<span class="dv">1</span>,<span class="dv">2</span>],<span class="fl">0.01</span>);</span>
<span id="cb167-164"><a href="cjs_with_mix.html#cb167-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-165"><a href="cjs_with_mix.html#cb167-165" aria-hidden="true" tabindex="-1"></a>  <span class="co">// likelihood for identified individuals</span></span>
<span id="cb167-166"><a href="cjs_with_mix.html#cb167-166" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:nindi) {</span>
<span id="cb167-167"><a href="cjs_with_mix.html#cb167-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lasti[i]&gt;<span class="dv">0</span>) {</span>
<span id="cb167-168"><a href="cjs_with_mix.html#cb167-168" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> firsti[i]:lasti[i]) {</span>
<span id="cb167-169"><a href="cjs_with_mix.html#cb167-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(k&gt;<span class="dv">1</span>) <span class="kw">target+=</span> (log(phi[i, k<span class="dv">-1</span>])); </span>
<span id="cb167-170"><a href="cjs_with_mix.html#cb167-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (yi[i,k] == <span class="dv">1</span>) <span class="kw">target+=</span>(log(p[i,k]));   </span>
<span id="cb167-171"><a href="cjs_with_mix.html#cb167-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="kw">target+=</span>(log1m(p[i,k]));  </span>
<span id="cb167-172"><a href="cjs_with_mix.html#cb167-172" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-173"><a href="cjs_with_mix.html#cb167-173" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb167-174"><a href="cjs_with_mix.html#cb167-174" aria-hidden="true" tabindex="-1"></a>    <span class="kw">target+=</span>(log(chi[i,lasti[i]+<span class="dv">1</span>]));</span>
<span id="cb167-175"><a href="cjs_with_mix.html#cb167-175" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb167-176"><a href="cjs_with_mix.html#cb167-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb167-177"><a href="cjs_with_mix.html#cb167-177" aria-hidden="true" tabindex="-1"></a>  <span class="co">// likelihood for non-identified individuals</span></span>
<span id="cb167-178"><a href="cjs_with_mix.html#cb167-178" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:nindni) {</span>
<span id="cb167-179"><a href="cjs_with_mix.html#cb167-179" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> log_like_male = <span class="dv">0</span>;</span>
<span id="cb167-180"><a href="cjs_with_mix.html#cb167-180" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real</span> log_like_female = <span class="dv">0</span>;</span>
<span id="cb167-181"><a href="cjs_with_mix.html#cb167-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-182"><a href="cjs_with_mix.html#cb167-182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lastni[i]&gt;<span class="dv">0</span>) {</span>
<span id="cb167-183"><a href="cjs_with_mix.html#cb167-183" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> firstni[i]:lastni[i]) {</span>
<span id="cb167-184"><a href="cjs_with_mix.html#cb167-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(k&gt;<span class="dv">1</span>){</span>
<span id="cb167-185"><a href="cjs_with_mix.html#cb167-185" aria-hidden="true" tabindex="-1"></a>          log_like_male += (log(phi_male[i, k<span class="dv">-1</span>]));</span>
<span id="cb167-186"><a href="cjs_with_mix.html#cb167-186" aria-hidden="true" tabindex="-1"></a>          log_like_female += (log(phi_female[i, k<span class="dv">-1</span>]));</span>
<span id="cb167-187"><a href="cjs_with_mix.html#cb167-187" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-188"><a href="cjs_with_mix.html#cb167-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (yni[i,k] == <span class="dv">1</span>){ </span>
<span id="cb167-189"><a href="cjs_with_mix.html#cb167-189" aria-hidden="true" tabindex="-1"></a>          log_like_male+=(log(p_male[i,k]));</span>
<span id="cb167-190"><a href="cjs_with_mix.html#cb167-190" aria-hidden="true" tabindex="-1"></a>          log_like_female+=(log(p_female[i,k]));</span>
<span id="cb167-191"><a href="cjs_with_mix.html#cb167-191" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-192"><a href="cjs_with_mix.html#cb167-192" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>{</span>
<span id="cb167-193"><a href="cjs_with_mix.html#cb167-193" aria-hidden="true" tabindex="-1"></a>          log_like_male+=(log1m(p_male[i,k])); </span>
<span id="cb167-194"><a href="cjs_with_mix.html#cb167-194" aria-hidden="true" tabindex="-1"></a>          log_like_female+=(log1m(p_female[i,k])); </span>
<span id="cb167-195"><a href="cjs_with_mix.html#cb167-195" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb167-196"><a href="cjs_with_mix.html#cb167-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-197"><a href="cjs_with_mix.html#cb167-197" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb167-198"><a href="cjs_with_mix.html#cb167-198" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb167-199"><a href="cjs_with_mix.html#cb167-199" aria-hidden="true" tabindex="-1"></a>    log_like_male += (log(chi_male[i,lastni[i]+<span class="dv">1</span>]));</span>
<span id="cb167-200"><a href="cjs_with_mix.html#cb167-200" aria-hidden="true" tabindex="-1"></a>    log_like_female += (log(chi_female[i,lastni[i]+<span class="dv">1</span>]));</span>
<span id="cb167-201"><a href="cjs_with_mix.html#cb167-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb167-202"><a href="cjs_with_mix.html#cb167-202" aria-hidden="true" tabindex="-1"></a>    <span class="kw">target +=</span> log_mix(theta[i], log_like_male, log_like_female);</span>
<span id="cb167-203"><a href="cjs_with_mix.html#cb167-203" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb167-204"><a href="cjs_with_mix.html#cb167-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-205"><a href="cjs_with_mix.html#cb167-205" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="call-stan-from-r-check-convergence-and-look-at-results" class="section level2 hasAnchor" number="25.5">
<h2><span class="header-section-number">25.5</span> Call Stan from R, check convergence and look at results<a href="cjs_with_mix.html#call-stan-from-r-check-convergence-and-look-at-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="cjs_with_mix.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run STAN</span></span>
<span id="cb168-2"><a href="cjs_with_mix.html#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb168-3"><a href="cjs_with_mix.html#cb168-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">&quot;stanmodels/cmr_mixture_model.stan&quot;</span>, <span class="at">data=</span>datax, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb168-4"><a href="cjs_with_mix.html#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for above simulated data (25000 individuals x 15 time periods) </span></span>
<span id="cb168-5"><a href="cjs_with_mix.html#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="co"># computing time is around 48 hours on an intel corei7 laptop</span></span>
<span id="cb168-6"><a href="cjs_with_mix.html#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for larger data sets, we recommed moving the transformed parameters block </span></span>
<span id="cb168-7"><a href="cjs_with_mix.html#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to the model block in order to avoid monitoring of p_male, p_female, </span></span>
<span id="cb168-8"><a href="cjs_with_mix.html#cb168-8" aria-hidden="true" tabindex="-1"></a><span class="co"># phi_male and phi_female producing memory problems</span></span>
<span id="cb168-9"><a href="cjs_with_mix.html#cb168-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-10"><a href="cjs_with_mix.html#cb168-10" aria-hidden="true" tabindex="-1"></a><span class="co"># launch_shinystan(fit) # diagnostic plots</span></span>
<span id="cb168-11"><a href="cjs_with_mix.html#cb168-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>##                 mean      se_mean         sd        2.5%         25%
## b0[1,1]   0.60132367 0.0015709423 0.06173884  0.48042366  0.55922253
## b0[1,2]   0.70098709 0.0012519948 0.04969428  0.60382019  0.66806698
## b0[1,3]   0.50293513 0.0010904085 0.04517398  0.41491848  0.47220346
## b0[1,4]   0.28118209 0.0008809447 0.03577334  0.21440931  0.25697691
## b0[1,5]   0.34938289 0.0009901335 0.03647815  0.27819918  0.32351323
## b0[1,6]   0.13158569 0.0006914740 0.02627423  0.08664129  0.11286629
## b0[1,7]   0.61182981 0.0010463611 0.04129602  0.53187976  0.58387839
## b0[1,8]   0.48535193 0.0010845951 0.04155762  0.40559440  0.45750793
## b0[1,9]   0.52531291 0.0008790063 0.03704084  0.45247132  0.50064513
## b0[1,10]  0.87174780 0.0007565552 0.03000936  0.80818138  0.85259573
## b0[1,11]  0.80185454 0.0009425675 0.03518166  0.73173810  0.77865187
## b0[1,12]  0.33152443 0.0008564381 0.03628505  0.26380840  0.30697293
## b0[1,13]  0.42132288 0.0012174784 0.04140382  0.34062688  0.39305210
## b0[1,14]  0.65180372 0.0015151039 0.05333953  0.55349105  0.61560493
## b0[2,1]   0.34237039 0.0041467200 0.12925217  0.12002285  0.24717176
## b0[2,2]   0.18534646 0.0023431250 0.07547704  0.05924694  0.12871584
## b0[2,3]   0.61351083 0.0024140550 0.07679100  0.46647727  0.56242546
## b0[2,4]   0.37140208 0.0024464965 0.06962399  0.24693888  0.32338093
## b0[2,5]   0.19428215 0.0034618302 0.11214798  0.02800056  0.11146326
## b0[2,6]   0.27371336 0.0026553769 0.09054020  0.11827243  0.20785316
## b0[2,7]   0.18611173 0.0014387436 0.05328492  0.09122869  0.14789827
## b0[2,8]   0.25648337 0.0018258589 0.05287800  0.16255769  0.21913271
## b0[2,9]   0.20378754 0.0021367769 0.07380004  0.07777998  0.15215845
## b0[2,10]  0.52679548 0.0024625568 0.08696008  0.36214334  0.46594844
## b0[2,11]  0.47393354 0.0032593161 0.10555065  0.28843967  0.39781278
## b0[2,12]  0.22289155 0.0017082729 0.05551514  0.12576797  0.18203335
## b0[2,13]  0.26191486 0.0024159794 0.07016314  0.14106495  0.21234017
## b0[2,14]  0.65111737 0.0055743944 0.18780555  0.29279480  0.50957591
## a0[1,1]   0.95440670 0.0013771881 0.04808748  0.86301660  0.92146330
## a0[1,2]   0.01529770 0.0469699511 1.46995922 -2.82218067 -0.95533706
## a0[2,1]   0.16384995 0.0049928331 0.12634422 -0.06399631  0.07533962
## a0[2,2]   0.01535679 0.0469634175 1.47006964 -2.81864060 -0.95515751
## a1[1,1]   0.15937249 0.0028992587 0.08864790 -0.01288607  0.10017613
## a1[1,2]   0.08055953 0.1007089857 3.02148727 -5.95525636 -1.96662599
## a1[2,1]  -0.83614134 0.0074143920 0.18655882 -1.21033848 -0.95698565
## a1[2,2]   0.08071668 0.1006904255 3.02145647 -5.94617355 -1.96508733
##                  50%        75%      97.5%     n_eff     Rhat
## b0[1,1]   0.60206306  0.6431566  0.7206343 1544.5301 1.002331
## b0[1,2]   0.70165494  0.7355204  0.7946280 1575.4617 1.001482
## b0[1,3]   0.50367411  0.5330078  0.5898079 1716.3196 1.001183
## b0[1,4]   0.27997512  0.3046483  0.3544592 1649.0040 1.000760
## b0[1,5]   0.34936442  0.3751935  0.4191138 1357.3073 1.002072
## b0[1,6]   0.12987449  0.1481661  0.1873982 1443.8040 1.003676
## b0[1,7]   0.61203228  0.6397577  0.6933929 1557.5904 1.001458
## b0[1,8]   0.48513822  0.5134314  0.5672066 1468.1355 1.002511
## b0[1,9]   0.52534212  0.5501747  0.5994060 1775.7335 1.000824
## b0[1,10]  0.87324112  0.8934047  0.9258033 1573.3747 1.000719
## b0[1,11]  0.80300311  0.8261868  0.8675033 1393.1817 1.001172
## b0[1,12]  0.33044476  0.3552199  0.4052902 1794.9956 1.000566
## b0[1,13]  0.42116690  0.4492297  0.5026942 1156.5339 1.000289
## b0[1,14]  0.64956850  0.6864706  0.7607107 1239.4056 1.004061
## b0[2,1]   0.33493631  0.4251416  0.6150923  971.5524 1.004049
## b0[2,2]   0.17981663  0.2358847  0.3446097 1037.6210 1.001474
## b0[2,3]   0.61326419  0.6644156  0.7628427 1011.8737 1.005727
## b0[2,4]   0.36837778  0.4158585  0.5190457  809.8949 1.003803
## b0[2,5]   0.17910449  0.2591418  0.4533117 1049.4733 1.001499
## b0[2,6]   0.26739172  0.3299594  0.4685139 1162.6006 1.001170
## b0[2,7]   0.18254607  0.2198969  0.3003156 1371.6455 1.000878
## b0[2,8]   0.25280556  0.2895585  0.3704113  838.7174 1.005624
## b0[2,9]   0.19724053  0.2501298  0.3694806 1192.8747 1.003687
## b0[2,10]  0.52587075  0.5845730  0.7061694 1247.0027 1.002851
## b0[2,11]  0.46874445  0.5392302  0.7046892 1048.7425 0.999473
## b0[2,12]  0.21961656  0.2580782  0.3397127 1056.1081 1.000907
## b0[2,13]  0.25601959  0.3056204  0.4142888  843.3960 1.003130
## b0[2,14]  0.65824835  0.7973674  0.9698829 1135.0669 1.003838
## a0[1,1]   0.95368445  0.9862439  1.0515747 1219.2071 1.003898
## a0[1,2]   0.01633534  0.9911055  2.9717839  979.4231 1.003726
## a0[2,1]   0.15519648  0.2472483  0.4230776  640.3489 1.004625
## a0[2,2]   0.01587281  0.9898084  2.9659552  979.8429 1.003744
## a1[1,1]   0.15647489  0.2205720  0.3354845  934.8953 1.007190
## a1[1,2]   0.06683287  2.1568781  6.0295208  900.1297 1.003701
## a1[2,1]  -0.83503982 -0.7075691 -0.4814539  633.1119 1.010568
## a1[2,2]   0.06586905  2.1557247  6.0239735  900.4432 1.003704</code></pre>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="dailynestsurv.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referenzen.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TobiasRoth/BDAEcology/edit/master/3.3-cjs_with_mix.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
