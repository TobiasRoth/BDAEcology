<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>15 Generalized linear mixed models | Bayesian Data Analysis in Ecology with R and Stan</title>
  <meta name="description" content="This GitHub-book is a collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="15 Generalized linear mixed models | Bayesian Data Analysis in Ecology with R and Stan" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/cover.jpg" />
  <meta property="og:description" content="This GitHub-book is a collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="github-repo" content="TobiasRoth/BDAEcology" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="15 Generalized linear mixed models | Bayesian Data Analysis in Ecology with R and Stan" />
  
  <meta name="twitter:description" content="This GitHub-book is a collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="twitter:image" content="/images/cover.jpg" />

<meta name="author" content="Fränzi Korner-Nievergelt, Tobias Roth, Stefanie von Felten, Jerôme Guélat, Bettina Almasi, Louis Hunninck, Pius Korner-Nievergelt" />


<meta name="date" content="2025-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="glm.html"/>
<link rel="next" href="modelchecking.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="settings/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>I BASIC STATISTICS FOR ECOLOGISTS</b></span></li>
<li class="chapter" data-level="1" data-path="PART-I.html"><a href="PART-I.html"><i class="fa fa-check"></i><b>1</b> Introduction to PART I</a>
<ul>
<li class="chapter" data-level="1.1" data-path="PART-I.html"><a href="PART-I.html#further-reading"><i class="fa fa-check"></i><b>1.1</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basics of statistics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#variables-and-observations"><i class="fa fa-check"></i><b>2.1</b> Variables and observations</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#displaying-and-summarizing-data"><i class="fa fa-check"></i><b>2.2</b> Displaying and summarizing data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basics.html"><a href="basics.html#histogram"><i class="fa fa-check"></i><b>2.2.1</b> Histogram</a></li>
<li class="chapter" data-level="2.2.2" data-path="basics.html"><a href="basics.html#location-and-scatter"><i class="fa fa-check"></i><b>2.2.2</b> Location and scatter</a></li>
<li class="chapter" data-level="2.2.3" data-path="basics.html"><a href="basics.html#correlations"><i class="fa fa-check"></i><b>2.2.3</b> Correlations</a></li>
<li class="chapter" data-level="2.2.4" data-path="basics.html"><a href="basics.html#principal-components-analyses-pca"><i class="fa fa-check"></i><b>2.2.4</b> Principal components analyses PCA</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#inferential-statistics"><i class="fa fa-check"></i><b>2.3</b> Inferential statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#uncertainty"><i class="fa fa-check"></i><b>2.3.1</b> Uncertainty</a></li>
<li class="chapter" data-level="2.3.2" data-path="basics.html"><a href="basics.html#standard-error"><i class="fa fa-check"></i><b>2.3.2</b> Standard error</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#bayes-theorem-and-the-common-aim-of-frequentist-and-bayesian-methods"><i class="fa fa-check"></i><b>2.4</b> Bayes theorem and the common aim of frequentist and Bayesian methods</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="basics.html"><a href="basics.html#bayes-theorem-for-discrete-events"><i class="fa fa-check"></i><b>2.4.1</b> Bayes theorem for discrete events</a></li>
<li class="chapter" data-level="2.4.2" data-path="basics.html"><a href="basics.html#bayes-theorem-for-continuous-parameters"><i class="fa fa-check"></i><b>2.4.2</b> Bayes theorem for continuous parameters</a></li>
<li class="chapter" data-level="2.4.3" data-path="basics.html"><a href="basics.html#estimating-a-mean-assuming-that-the-variance-is-known"><i class="fa fa-check"></i><b>2.4.3</b> Estimating a mean assuming that the variance is known</a></li>
<li class="chapter" data-level="2.4.4" data-path="basics.html"><a href="basics.html#estimating-the-mean-and-the-variance"><i class="fa fa-check"></i><b>2.4.4</b> Estimating the mean and the variance</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#classical-frequentist-tests-and-alternatives"><i class="fa fa-check"></i><b>2.5</b> Classical frequentist tests and alternatives</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="basics.html"><a href="basics.html#nullhypothesis-testing"><i class="fa fa-check"></i><b>2.5.1</b> Nullhypothesis testing</a></li>
<li class="chapter" data-level="2.5.2" data-path="basics.html"><a href="basics.html#comparison-of-a-sample-with-a-fixed-value-one-sample-t-test"><i class="fa fa-check"></i><b>2.5.2</b> Comparison of a sample with a fixed value (one-sample t-test)</a></li>
<li class="chapter" data-level="2.5.3" data-path="basics.html"><a href="basics.html#comparison-of-the-locations-between-two-groups-two-sample-t-test"><i class="fa fa-check"></i><b>2.5.3</b> Comparison of the locations between two groups (two-sample t-test)</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#whyBayes"><i class="fa fa-check"></i><b>2.6</b> Comparing frequentist and Bayesian approach - an why we use Bayes</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#summary"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="analyses_steps.html"><a href="analyses_steps.html"><i class="fa fa-check"></i><b>3</b> Data analysis step by step</a>
<ul>
<li class="chapter" data-level="3.1" data-path="analyses_steps.html"><a href="analyses_steps.html#step1"><i class="fa fa-check"></i><b>3.1</b> Plausibility of data</a></li>
<li class="chapter" data-level="3.2" data-path="analyses_steps.html"><a href="analyses_steps.html#step2"><i class="fa fa-check"></i><b>3.2</b> Relationships</a></li>
<li class="chapter" data-level="3.3" data-path="analyses_steps.html"><a href="analyses_steps.html#step3"><i class="fa fa-check"></i><b>3.3</b> Data distribution</a></li>
<li class="chapter" data-level="3.4" data-path="analyses_steps.html"><a href="analyses_steps.html#step4"><i class="fa fa-check"></i><b>3.4</b> Preparation of explanatory variables</a></li>
<li class="chapter" data-level="3.5" data-path="analyses_steps.html"><a href="analyses_steps.html#step5"><i class="fa fa-check"></i><b>3.5</b> Data structure</a></li>
<li class="chapter" data-level="3.6" data-path="analyses_steps.html"><a href="analyses_steps.html#step6"><i class="fa fa-check"></i><b>3.6</b> Define prior distributions</a></li>
<li class="chapter" data-level="3.7" data-path="analyses_steps.html"><a href="analyses_steps.html#step7"><i class="fa fa-check"></i><b>3.7</b> Fit the model</a></li>
<li class="chapter" data-level="3.8" data-path="analyses_steps.html"><a href="analyses_steps.html#step8"><i class="fa fa-check"></i><b>3.8</b> Check model</a></li>
<li class="chapter" data-level="3.9" data-path="analyses_steps.html"><a href="analyses_steps.html#step9"><i class="fa fa-check"></i><b>3.9</b> Model uncertainty</a></li>
<li class="chapter" data-level="3.10" data-path="analyses_steps.html"><a href="analyses_steps.html#step10"><i class="fa fa-check"></i><b>3.10</b> Present model results</a></li>
<li class="chapter" data-level="" data-path="analyses_steps.html"><a href="analyses_steps.html#further-reading-1"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>4</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="distributions.html"><a href="distributions.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="distributions.html"><a href="distributions.html#discrete-distributions"><i class="fa fa-check"></i><b>4.2</b> Discrete distributions</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="distributions.html"><a href="distributions.html#bernoulli-dist"><i class="fa fa-check"></i><b>4.2.1</b> Bernoulli distribution</a></li>
<li class="chapter" data-level="4.2.2" data-path="distributions.html"><a href="distributions.html#binomial-dist"><i class="fa fa-check"></i><b>4.2.2</b> Binomial distribution</a></li>
<li class="chapter" data-level="4.2.3" data-path="distributions.html"><a href="distributions.html#poisson"><i class="fa fa-check"></i><b>4.2.3</b> Poisson distribution</a></li>
<li class="chapter" data-level="4.2.4" data-path="distributions.html"><a href="distributions.html#negative-binomial-distribution"><i class="fa fa-check"></i><b>4.2.4</b> Negative-binomial distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="distributions.html"><a href="distributions.html#continuous-distributions"><i class="fa fa-check"></i><b>4.3</b> Continuous distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="distributions.html"><a href="distributions.html#beta-distribution"><i class="fa fa-check"></i><b>4.3.1</b> Beta distribution</a></li>
<li class="chapter" data-level="4.3.2" data-path="distributions.html"><a href="distributions.html#normdist"><i class="fa fa-check"></i><b>4.3.2</b> Normal distribution</a></li>
<li class="chapter" data-level="4.3.3" data-path="distributions.html"><a href="distributions.html#gamma-distribution"><i class="fa fa-check"></i><b>4.3.3</b> Gamma distribution</a></li>
<li class="chapter" data-level="4.3.4" data-path="distributions.html"><a href="distributions.html#cauchydistri"><i class="fa fa-check"></i><b>4.3.4</b> Cauchy distribution</a></li>
<li class="chapter" data-level="4.3.5" data-path="distributions.html"><a href="distributions.html#t-distribution"><i class="fa fa-check"></i><b>4.3.5</b> t-distribution</a></li>
<li class="chapter" data-level="4.3.6" data-path="distributions.html"><a href="distributions.html#f-distribution"><i class="fa fa-check"></i><b>4.3.6</b> F-distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>5</b> Transformations</a>
<ul>
<li class="chapter" data-level="5.1" data-path="transformations.html"><a href="transformations.html#some-r-specific-aspects"><i class="fa fa-check"></i><b>5.1</b> Some R-specific aspects</a></li>
<li class="chapter" data-level="5.2" data-path="transformations.html"><a href="transformations.html#first-aid-transformations"><i class="fa fa-check"></i><b>5.2</b> First-aid transformations</a></li>
<li class="chapter" data-level="5.3" data-path="transformations.html"><a href="transformations.html#logtransformation"><i class="fa fa-check"></i><b>5.3</b> Log-transformation with Stahel</a></li>
<li class="chapter" data-level="5.4" data-path="transformations.html"><a href="transformations.html#ztransformation"><i class="fa fa-check"></i><b>5.4</b> Centering and scaling (z-transformation)</a></li>
<li class="chapter" data-level="5.5" data-path="transformations.html"><a href="transformations.html#transformationspolynomials"><i class="fa fa-check"></i><b>5.5</b> Raw and orthogonal polynomials</a></li>
<li class="chapter" data-level="5.6" data-path="transformations.html"><a href="transformations.html#square-root-transformation"><i class="fa fa-check"></i><b>5.6</b> Square-root transformation</a></li>
<li class="chapter" data-level="5.7" data-path="transformations.html"><a href="transformations.html#arcsinus-square-root-transformation"><i class="fa fa-check"></i><b>5.7</b> Arcsinus-square-root transformation</a></li>
<li class="chapter" data-level="5.8" data-path="transformations.html"><a href="transformations.html#logit-transformation"><i class="fa fa-check"></i><b>5.8</b> Logit transformation</a></li>
<li class="chapter" data-level="5.9" data-path="transformations.html"><a href="transformations.html#categorizing-and-decategorizing"><i class="fa fa-check"></i><b>5.9</b> Categorizing and decategorizing</a></li>
<li class="chapter" data-level="5.10" data-path="transformations.html"><a href="transformations.html#transformationscircular"><i class="fa fa-check"></i><b>5.10</b> Sinus and cosinus transformation for circular variables</a></li>
<li class="chapter" data-level="5.11" data-path="transformations.html"><a href="transformations.html#cloglog-probit-inverse-transformation"><i class="fa fa-check"></i><b>5.11</b> Cloglog, probit, inverse transformation</a></li>
<li class="chapter" data-level="5.12" data-path="transformations.html"><a href="transformations.html#identity-transformation"><i class="fa fa-check"></i><b>5.12</b> Identity transformation</a></li>
<li class="chapter" data-level="5.13" data-path="transformations.html"><a href="transformations.html#transformations-on-the-outcome-variable"><i class="fa fa-check"></i><b>5.13</b> Transformations on the outcome variable</a></li>
<li class="chapter" data-level="5.14" data-path="transformations.html"><a href="transformations.html#back-transformation"><i class="fa fa-check"></i><b>5.14</b> Back-transformation</a></li>
<li class="chapter" data-level="5.15" data-path="transformations.html"><a href="transformations.html#applythesametransformation"><i class="fa fa-check"></i><b>5.15</b> Applying the transformations to new data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproducibleresearch.html"><a href="reproducibleresearch.html"><i class="fa fa-check"></i><b>6</b> Reproducible research</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reproducibleresearch.html"><a href="reproducibleresearch.html#summary-1"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
<li class="chapter" data-level="6.2" data-path="reproducibleresearch.html"><a href="reproducibleresearch.html#further-reading-2"><i class="fa fa-check"></i><b>6.2</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="furthertopics.html"><a href="furthertopics.html"><i class="fa fa-check"></i><b>7</b> Further topics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="furthertopics.html"><a href="furthertopics.html#bioacoustic-analyse"><i class="fa fa-check"></i><b>7.1</b> Bioacoustic analyse</a></li>
<li class="chapter" data-level="7.2" data-path="furthertopics.html"><a href="furthertopics.html#python"><i class="fa fa-check"></i><b>7.2</b> Python</a></li>
<li class="chapter" data-level="7.3" data-path="furthertopics.html"><a href="furthertopics.html#some-r"><i class="fa fa-check"></i><b>7.3</b> Some R</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="furthertopics.html"><a href="furthertopics.html#date-on-x-axis"><i class="fa fa-check"></i><b>7.3.1</b> Date on x-axis</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II BAYESIAN DATA ANALYSIS</b></span></li>
<li class="chapter" data-level="8" data-path="PART-II.html"><a href="PART-II.html"><i class="fa fa-check"></i><b>8</b> Introduction to PART II</a>
<ul>
<li class="chapter" data-level="" data-path="PART-II.html"><a href="PART-II.html#further-reading-3"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html"><i class="fa fa-check"></i><b>9</b> The Bayesian paradigm and likelihood in a frequentist and Bayesian framework</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#short-historical-overview"><i class="fa fa-check"></i><b>9.1</b> Short historical overview</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#the-bayesian-way"><i class="fa fa-check"></i><b>9.2</b> The Bayesian way</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#likelihood"><i class="fa fa-check"></i><b>9.3</b> Likelihood</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#theory"><i class="fa fa-check"></i><b>9.3.1</b> Theory</a></li>
<li class="chapter" data-level="9.3.2" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#the-maximum-likelihood-method"><i class="fa fa-check"></i><b>9.3.2</b> The maximum likelihood method</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#the-log-pointwise-predictive-density"><i class="fa fa-check"></i><b>9.4</b> The log pointwise predictive density</a></li>
<li class="chapter" data-level="9.5" data-path="bayesian_paradigm.html"><a href="bayesian_paradigm.html#further-reading-4"><i class="fa fa-check"></i><b>9.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="priors.html"><a href="priors.html"><i class="fa fa-check"></i><b>10</b> Prior distributions and prior sensitivity analyses</a>
<ul>
<li class="chapter" data-level="10.1" data-path="priors.html"><a href="priors.html#introduction-1"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="priors.html"><a href="priors.html#choosepriors"><i class="fa fa-check"></i><b>10.2</b> How to choose a prior</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="priors.html"><a href="priors.html#priors-for-variance-parameters"><i class="fa fa-check"></i><b>10.2.1</b> Priors for variance parameters</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="priors.html"><a href="priors.html#prior-sensitivity"><i class="fa fa-check"></i><b>10.3</b> Prior sensitivity</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="lm.html"><a href="lm.html"><i class="fa fa-check"></i><b>11</b> Normal Linear Models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="lm.html"><a href="lm.html#linear-regression"><i class="fa fa-check"></i><b>11.1</b> Linear regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="lm.html"><a href="lm.html#background"><i class="fa fa-check"></i><b>11.1.1</b> Background</a></li>
<li class="chapter" data-level="11.1.2" data-path="lm.html"><a href="lm.html#fitting-a-linear-regression-in-r"><i class="fa fa-check"></i><b>11.1.2</b> Fitting a linear regression in R</a></li>
<li class="chapter" data-level="11.1.3" data-path="lm.html"><a href="lm.html#presenting-the-results"><i class="fa fa-check"></i><b>11.1.3</b> Presenting the results</a></li>
<li class="chapter" data-level="11.1.4" data-path="lm.html"><a href="lm.html#interpretation-of-the-r-summary-output"><i class="fa fa-check"></i><b>11.1.4</b> Interpretation of the R summary output</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="lm.html"><a href="lm.html#linear-model-with-one-categorical-predictor-one-way-anova"><i class="fa fa-check"></i><b>11.2</b> Linear model with one categorical predictor (one-way ANOVA)</a></li>
<li class="chapter" data-level="11.3" data-path="lm.html"><a href="lm.html#other-variants-of-normal-linear-models"><i class="fa fa-check"></i><b>11.3</b> Other variants of normal linear models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="lm.html"><a href="lm.html#twowayanova"><i class="fa fa-check"></i><b>11.3.1</b> Linear model with two categorical predictors (two-way ANOVA)</a></li>
<li class="chapter" data-level="11.3.2" data-path="lm.html"><a href="lm.html#a-linear-model-with-a-categorical-and-a-numeric-predictor-ancova"><i class="fa fa-check"></i><b>11.3.2</b> A linear model with a categorical and a numeric predictor (ANCOVA)</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="lm.html"><a href="lm.html#collinearity"><i class="fa fa-check"></i><b>11.4</b> Partial coefficients and some comments on collinearity</a></li>
<li class="chapter" data-level="11.5" data-path="lm.html"><a href="lm.html#orderedfactors"><i class="fa fa-check"></i><b>11.5</b> Ordered factors and contrasts</a></li>
<li class="chapter" data-level="11.6" data-path="lm.html"><a href="lm.html#lmpolynomials"><i class="fa fa-check"></i><b>11.6</b> Quadratic and higher polynomial terms</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="residualanalysis.html"><a href="residualanalysis.html"><i class="fa fa-check"></i><b>12</b> Assessing model assumptions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="residualanalysis.html"><a href="residualanalysis.html#model-assumptions"><i class="fa fa-check"></i><b>12.1</b> Model assumptions</a></li>
<li class="chapter" data-level="12.2" data-path="residualanalysis.html"><a href="residualanalysis.html#independent-and-identically-distributed"><i class="fa fa-check"></i><b>12.2</b> Independent and identically distributed</a></li>
<li class="chapter" data-level="12.3" data-path="residualanalysis.html"><a href="residualanalysis.html#qqplot"><i class="fa fa-check"></i><b>12.3</b> The QQ-plot</a></li>
<li class="chapter" data-level="12.4" data-path="residualanalysis.html"><a href="residualanalysis.html#tempautocorrelation"><i class="fa fa-check"></i><b>12.4</b> Temporal autocorrelation</a></li>
<li class="chapter" data-level="12.5" data-path="residualanalysis.html"><a href="residualanalysis.html#spatialautocorrelation"><i class="fa fa-check"></i><b>12.5</b> Spatial autocorrelation</a></li>
<li class="chapter" data-level="12.6" data-path="residualanalysis.html"><a href="residualanalysis.html#Heteroscedasticity"><i class="fa fa-check"></i><b>12.6</b> Heteroscedasticity</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lmer.html"><a href="lmer.html"><i class="fa fa-check"></i><b>13</b> Linear mixed effect models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lmer.html"><a href="lmer.html#background-2"><i class="fa fa-check"></i><b>13.1</b> Background</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="lmer.html"><a href="lmer.html#why-mixed-effects-models"><i class="fa fa-check"></i><b>13.1.1</b> Why mixed effects models?</a></li>
<li class="chapter" data-level="13.1.2" data-path="lmer.html"><a href="lmer.html#shrinkage"><i class="fa fa-check"></i><b>13.1.2</b> Random factors and partial pooling</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="lmer.html"><a href="lmer.html#fitting-a-normal-linear-mixed-model-in-r"><i class="fa fa-check"></i><b>13.2</b> Fitting a normal linear mixed model in R</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="lmer.html"><a href="lmer.html#background-3"><i class="fa fa-check"></i><b>13.2.1</b> Background</a></li>
<li class="chapter" data-level="13.2.2" data-path="lmer.html"><a href="lmer.html#fitting-a-normal-linear-mixed-model-using-lmer-then-use-sim"><i class="fa fa-check"></i><b>13.2.2</b> Fitting a normal linear mixed model using lmer, then use sim</a></li>
<li class="chapter" data-level="13.2.3" data-path="lmer.html"><a href="lmer.html#fitting-a-normal-linear-model-using-rstanarm"><i class="fa fa-check"></i><b>13.2.3</b> Fitting a normal linear model using rstanarm</a></li>
<li class="chapter" data-level="13.2.4" data-path="lmer.html"><a href="lmer.html#fitting-a-normal-linear-model-using-brm"><i class="fa fa-check"></i><b>13.2.4</b> Fitting a normal linear model using brm</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="lmer.html"><a href="lmer.html#presenting-the-results-1"><i class="fa fa-check"></i><b>13.3</b> Presenting the results</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="lmer.html"><a href="lmer.html#presenting-the-results-from-sim"><i class="fa fa-check"></i><b>13.3.1</b> Presenting the results: from sim</a></li>
<li class="chapter" data-level="13.3.2" data-path="lmer.html"><a href="lmer.html#presenting-the-results-from-rstanarm"><i class="fa fa-check"></i><b>13.3.2</b> Presenting the results: from rstanarm</a></li>
<li class="chapter" data-level="13.3.3" data-path="lmer.html"><a href="lmer.html#presenting-the-results-from-brms"><i class="fa fa-check"></i><b>13.3.3</b> Presenting the results: from brms</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="lmer.html"><a href="lmer.html#random-intercept-and-slope"><i class="fa fa-check"></i><b>13.4</b> Random intercept and slope</a></li>
<li class="chapter" data-level="13.5" data-path="lmer.html"><a href="lmer.html#nested-and-crossed-random-effects"><i class="fa fa-check"></i><b>13.5</b> Nested and crossed random effects</a></li>
<li class="chapter" data-level="13.6" data-path="lmer.html"><a href="lmer.html#model-selection-in-mixed-models"><i class="fa fa-check"></i><b>13.6</b> Model selection in mixed models</a></li>
<li class="chapter" data-level="13.7" data-path="lmer.html"><a href="lmer.html#further-reading-5"><i class="fa fa-check"></i><b>13.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>14</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="glm.html"><a href="glm.html#introduction-2"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="glm.html"><a href="glm.html#bernoulli-model"><i class="fa fa-check"></i><b>14.2</b> Bernoulli model</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="glm.html"><a href="glm.html#background-4"><i class="fa fa-check"></i><b>14.2.1</b> Background</a></li>
<li class="chapter" data-level="14.2.2" data-path="glm.html"><a href="glm.html#fitting-a-bernoulli-model-in-r"><i class="fa fa-check"></i><b>14.2.2</b> Fitting a Bernoulli model in R</a></li>
<li class="chapter" data-level="14.2.3" data-path="glm.html"><a href="glm.html#assessing-model-assumptions-in-a-bernoulli-model"><i class="fa fa-check"></i><b>14.2.3</b> Assessing model assumptions in a Bernoulli model</a></li>
<li class="chapter" data-level="14.2.4" data-path="glm.html"><a href="glm.html#visualising-the-results"><i class="fa fa-check"></i><b>14.2.4</b> Visualising the results</a></li>
<li class="chapter" data-level="14.2.5" data-path="glm.html"><a href="glm.html#some-remarks"><i class="fa fa-check"></i><b>14.2.5</b> Some remarks</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="glm.html"><a href="glm.html#binomial-model"><i class="fa fa-check"></i><b>14.3</b> Binomial model</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="glm.html"><a href="glm.html#background-5"><i class="fa fa-check"></i><b>14.3.1</b> Background</a></li>
<li class="chapter" data-level="14.3.2" data-path="glm.html"><a href="glm.html#fitting-a-binomial-model-in-r"><i class="fa fa-check"></i><b>14.3.2</b> Fitting a binomial model in R</a></li>
<li class="chapter" data-level="14.3.3" data-path="glm.html"><a href="glm.html#assessing-assumptions-in-a-binomial-model"><i class="fa fa-check"></i><b>14.3.3</b> Assessing assumptions in a binomial model</a></li>
<li class="chapter" data-level="14.3.4" data-path="glm.html"><a href="glm.html#visualising-the-results-1"><i class="fa fa-check"></i><b>14.3.4</b> Visualising the results</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="glm.html"><a href="glm.html#poisson-model"><i class="fa fa-check"></i><b>14.4</b> Poisson model</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="glm.html"><a href="glm.html#background-6"><i class="fa fa-check"></i><b>14.4.1</b> Background</a></li>
<li class="chapter" data-level="14.4.2" data-path="glm.html"><a href="glm.html#fitting-a-poisson-model-in-r"><i class="fa fa-check"></i><b>14.4.2</b> Fitting a Poisson model in R</a></li>
<li class="chapter" data-level="14.4.3" data-path="glm.html"><a href="glm.html#assessing-model-assumptions"><i class="fa fa-check"></i><b>14.4.3</b> Assessing model assumptions</a></li>
<li class="chapter" data-level="14.4.4" data-path="glm.html"><a href="glm.html#visualising-results"><i class="fa fa-check"></i><b>14.4.4</b> Visualising results</a></li>
<li class="chapter" data-level="14.4.5" data-path="glm.html"><a href="glm.html#modeling-rates-and-densities-poisson-model-with-an-offset"><i class="fa fa-check"></i><b>14.4.5</b> Modeling rates and densities: Poisson model with an offset</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="glmm.html"><a href="glmm.html"><i class="fa fa-check"></i><b>15</b> Generalized linear mixed models</a>
<ul>
<li class="chapter" data-level="15.1" data-path="glmm.html"><a href="glmm.html#background-7"><i class="fa fa-check"></i><b>15.1</b> Background</a></li>
<li class="chapter" data-level="15.2" data-path="glmm.html"><a href="glmm.html#binomial-mixed-model"><i class="fa fa-check"></i><b>15.2</b> Binomial mixed model</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="glmm.html"><a href="glmm.html#background-8"><i class="fa fa-check"></i><b>15.2.1</b> Background</a></li>
<li class="chapter" data-level="15.2.2" data-path="glmm.html"><a href="glmm.html#fitting-a-binomial-mixed-model-in-r"><i class="fa fa-check"></i><b>15.2.2</b> Fitting a binomial mixed model in R</a></li>
<li class="chapter" data-level="15.2.3" data-path="glmm.html"><a href="glmm.html#presenting-the-results-2"><i class="fa fa-check"></i><b>15.2.3</b> Presenting the results</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="glmm.html"><a href="glmm.html#poisson-mixed-model"><i class="fa fa-check"></i><b>15.3</b> Poisson mixed model</a></li>
<li class="chapter" data-level="15.4" data-path="glmm.html"><a href="glmm.html#summary-2"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="modelchecking.html"><a href="modelchecking.html"><i class="fa fa-check"></i><b>16</b> Posterior predictive model checking</a></li>
<li class="chapter" data-level="17" data-path="model_comparison.html"><a href="model_comparison.html"><i class="fa fa-check"></i><b>17</b> Model comparison and multimodel inference</a>
<ul>
<li class="chapter" data-level="17.1" data-path="model_comparison.html"><a href="model_comparison.html#when-and-why-we-compare-models-and-why-model-selection-is-difficult"><i class="fa fa-check"></i><b>17.1</b> When and why we compare models and why model selection is difficult</a></li>
<li class="chapter" data-level="17.2" data-path="model_comparison.html"><a href="model_comparison.html#methods-for-model-commparison"><i class="fa fa-check"></i><b>17.2</b> Methods for model commparison</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="model_comparison.html"><a href="model_comparison.html#cross-validation"><i class="fa fa-check"></i><b>17.2.1</b> Cross-validation</a></li>
<li class="chapter" data-level="17.2.2" data-path="model_comparison.html"><a href="model_comparison.html#information-criteria-akaike-information-criterion-and-widely-applicable-information-criterion"><i class="fa fa-check"></i><b>17.2.2</b> Information criteria: Akaike information criterion and widely applicable information criterion</a></li>
<li class="chapter" data-level="17.2.3" data-path="model_comparison.html"><a href="model_comparison.html#other-information-criteria"><i class="fa fa-check"></i><b>17.2.3</b> Other information criteria</a></li>
<li class="chapter" data-level="17.2.4" data-path="model_comparison.html"><a href="model_comparison.html#bayes-factors-and-posterior-model-probabilities"><i class="fa fa-check"></i><b>17.2.4</b> Bayes factors and posterior model probabilities</a></li>
<li class="chapter" data-level="17.2.5" data-path="model_comparison.html"><a href="model_comparison.html#model-based-methods-to-obtain-posterior-model-probabilities-and-inclusion-probabilities"><i class="fa fa-check"></i><b>17.2.5</b> Model-based methods to obtain posterior model probabilities and inclusion probabilities</a></li>
<li class="chapter" data-level="17.2.6" data-path="model_comparison.html"><a href="model_comparison.html#least-absolute-shrinkage-and-selection-operator-lasso-and-ridge-regression"><i class="fa fa-check"></i><b>17.2.6</b> Least absolute shrinkage and selection operator (LASSO) and ridge regression</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="model_comparison.html"><a href="model_comparison.html#multimodel-inference"><i class="fa fa-check"></i><b>17.3</b> Multimodel inference</a></li>
<li class="chapter" data-level="17.4" data-path="model_comparison.html"><a href="model_comparison.html#which-method-to-choose-and-which-strategy-to-follow"><i class="fa fa-check"></i><b>17.4</b> Which method to choose and which strategy to follow?</a></li>
<li class="chapter" data-level="17.5" data-path="model_comparison.html"><a href="model_comparison.html#further-reading-6"><i class="fa fa-check"></i><b>17.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>18</b> MCMC using Stan via rstanarm, brms or rstan</a>
<ul>
<li class="chapter" data-level="18.1" data-path="stan.html"><a href="stan.html#background-9"><i class="fa fa-check"></i><b>18.1</b> Background</a></li>
<li class="chapter" data-level="18.2" data-path="stan.html"><a href="stan.html#assessing-convergence-of-the-markov-chains-and-trouble-shooting-warnings-of-stan"><i class="fa fa-check"></i><b>18.2</b> Assessing convergence of the Markov chains and trouble shooting warnings of Stan</a></li>
<li class="chapter" data-level="18.3" data-path="stan.html"><a href="stan.html#using-stan-via-rstan"><i class="fa fa-check"></i><b>18.3</b> Using Stan via rstan</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="stan.html"><a href="stan.html#firststanmod"><i class="fa fa-check"></i><b>18.3.1</b> Writing a Stan model</a></li>
<li class="chapter" data-level="18.3.2" data-path="stan.html"><a href="stan.html#run-stan-from-r-using-rstan"><i class="fa fa-check"></i><b>18.3.2</b> Run Stan from R using rstan</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#further-reading-7"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="ridge_regression.html"><a href="ridge_regression.html"><i class="fa fa-check"></i><b>19</b> Ridge Regression</a></li>
<li class="chapter" data-level="20" data-path="SEM.html"><a href="SEM.html"><i class="fa fa-check"></i><b>20</b> Structural equation models</a>
<ul>
<li class="chapter" data-level="20.1" data-path="SEM.html"><a href="SEM.html#introduction-3"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="spatial_glmm.html"><a href="spatial_glmm.html"><i class="fa fa-check"></i><b>21</b> Modeling spatial data using GLMM</a>
<ul>
<li class="chapter" data-level="21.1" data-path="spatial_glmm.html"><a href="spatial_glmm.html#introduction-4"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="spatial_glmm.html"><a href="spatial_glmm.html#summary-3"><i class="fa fa-check"></i><b>21.2</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>III ECOLOGICAL MODELS</b></span></li>
<li class="chapter" data-level="22" data-path="PART-III.html"><a href="PART-III.html"><i class="fa fa-check"></i><b>22</b> Introduction to PART III</a>
<ul>
<li class="chapter" data-level="22.1" data-path="PART-III.html"><a href="PART-III.html#model-notations"><i class="fa fa-check"></i><b>22.1</b> Model notations</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html"><i class="fa fa-check"></i><b>23</b> Zero-inflated Poisson mixed model</a>
<ul>
<li class="chapter" data-level="23.1" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#introduction-5"><i class="fa fa-check"></i><b>23.1</b> Introduction</a></li>
<li class="chapter" data-level="23.2" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#example-data"><i class="fa fa-check"></i><b>23.2</b> Example data</a></li>
<li class="chapter" data-level="23.3" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#model"><i class="fa fa-check"></i><b>23.3</b> Model</a></li>
<li class="chapter" data-level="23.4" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#further-packages-and-readings"><i class="fa fa-check"></i><b>23.4</b> Further packages and readings</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="dailynestsurv.html"><a href="dailynestsurv.html"><i class="fa fa-check"></i><b>24</b> Daily nest survival</a>
<ul>
<li class="chapter" data-level="24.1" data-path="dailynestsurv.html"><a href="dailynestsurv.html#background-10"><i class="fa fa-check"></i><b>24.1</b> Background</a></li>
<li class="chapter" data-level="24.2" data-path="dailynestsurv.html"><a href="dailynestsurv.html#models-for-estimating-daily-nest-survival"><i class="fa fa-check"></i><b>24.2</b> Models for estimating daily nest survival</a></li>
<li class="chapter" data-level="24.3" data-path="dailynestsurv.html"><a href="dailynestsurv.html#known-fate-model"><i class="fa fa-check"></i><b>24.3</b> Known fate model</a></li>
<li class="chapter" data-level="24.4" data-path="dailynestsurv.html"><a href="dailynestsurv.html#dailynestsurvstan"><i class="fa fa-check"></i><b>24.4</b> The Stan model</a></li>
<li class="chapter" data-level="24.5" data-path="dailynestsurv.html"><a href="dailynestsurv.html#prepare-data-and-run-stan"><i class="fa fa-check"></i><b>24.5</b> Prepare data and run Stan</a></li>
<li class="chapter" data-level="24.6" data-path="dailynestsurv.html"><a href="dailynestsurv.html#check-convergence"><i class="fa fa-check"></i><b>24.6</b> Check convergence</a></li>
<li class="chapter" data-level="24.7" data-path="dailynestsurv.html"><a href="dailynestsurv.html#look-at-results"><i class="fa fa-check"></i><b>24.7</b> Look at results</a></li>
<li class="chapter" data-level="24.8" data-path="dailynestsurv.html"><a href="dailynestsurv.html#known-fate-model-for-irregular-nest-controls"><i class="fa fa-check"></i><b>24.8</b> Known fate model for irregular nest controls</a></li>
<li class="chapter" data-level="" data-path="dailynestsurv.html"><a href="dailynestsurv.html#further-reading-8"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html"><i class="fa fa-check"></i><b>25</b> Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals</a>
<ul>
<li class="chapter" data-level="25.1" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#introduction-6"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#data-description"><i class="fa fa-check"></i><b>25.2</b> Data description</a></li>
<li class="chapter" data-level="25.3" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#model-description"><i class="fa fa-check"></i><b>25.3</b> Model description</a></li>
<li class="chapter" data-level="25.4" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#the-stan-code"><i class="fa fa-check"></i><b>25.4</b> The Stan code</a></li>
<li class="chapter" data-level="25.5" data-path="cjs_with_mix.html"><a href="cjs_with_mix.html#call-stan-from-r-check-convergence-and-look-at-results"><i class="fa fa-check"></i><b>25.5</b> Call Stan from R, check convergence and look at results</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="samplesize.html"><a href="samplesize.html"><i class="fa fa-check"></i><b>26</b> What sample size?</a>
<ul>
<li class="chapter" data-level="26.1" data-path="samplesize.html"><a href="samplesize.html#introduction-7"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
</ul></li>
<li class="part"><span><b>IV APPENDICES</b></span></li>
<li class="chapter" data-level="" data-path="referenzen.html"><a href="referenzen.html"><i class="fa fa-check"></i>Referenzen</a></li>
<li class="divider"></li>
</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis in Ecology with R and Stan</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="glmm" class="section level1 hasAnchor" number="15">
<h1><span class="header-section-number">15</span> Generalized linear mixed models<a href="glmm.html#glmm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="" target="_blank"><img src="images/Cordulegaster_boltonii.jpg" width="1254" style="display: block; margin: auto;" /></a></p>
<hr />
<div id="background-7" class="section level2 hasAnchor" number="15.1">
<h2><span class="header-section-number">15.1</span> Background<a href="glmm.html#background-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- Steffis draft version, started 17.11.2021, fk worked on it 15.11.2022, svf revised it 22.11.2022-->
<p>In chapter <a href="lmer.html#lmer">13</a> on linear mixed effect models we have introduced how to analyze metric outcome variables for which a normal error distribution can be assumed (potentially after transformation), when the data have a hierarchical structure and, as a consequence, observations are not independent.
In chapter <a href="glm.html#glm">14</a> on generalized linear models we have introduced how to analyze outcome variables for which a normal error distribution can not be assumed, as for example binary outcomes or count data. More precisely, we have extended modelling outcomes with normal error to modelling outcomes with error distributions from the exponential family (e.g., binomial or Poisson).
Generalized linear mixed models (GLMM) combine the two complexities and are used to analyze outcomes with a non-normal error distribution when the data have a hierarchical structure. In this chapter, we will show how to analyze such data. Remember, a hierarchical structure of the data means that the data are collected at different levels, for example smaller and larger spatial units, or include repeated measurements in time on a specific subject. Typically, the outcome variable is measured/observed at the lowest level but other variables may be measured at different levels. A first example is introduced in the next section.</p>
</div>
<div id="binomial-mixed-model" class="section level2 hasAnchor" number="15.2">
<h2><span class="header-section-number">15.2</span> Binomial mixed model<a href="glmm.html#binomial-mixed-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="background-8" class="section level3 hasAnchor" number="15.2.1">
<h3><span class="header-section-number">15.2.1</span> Background<a href="glmm.html#background-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- text from old book, slightly modified
https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html
Items can be cited directly within the documentation using the syntax @key where key is the citation key in the first line of the entry, e.g., @R-base. To put citations in parentheses, use [@key]. To cite multiple entries, separate the keys by semicolons, e.g., [@key-1; @key-2; @key-3]. To suppress the mention of the author, add a minus sign before @, e.g., [-@R-base].
-->
<p>To illustrate the binomial mixed model we use a subset of a data set used by <span class="citation">Grüebler, Korner-Nievergelt, and Hirschheydt (<a href="referenzen.html#ref-Gruebler.2010">2010</a>)</span> on barn swallow <em>Hirundo rustica</em> nestling survival (we selected a nonrandom sample to be able to fit a simple model; hence, the results do not add unbiased knowledge about the swallow biology!). For 63 swallow broods, we know the clutch size and the number of the nestlings that
fledged. The broods came from 51 farms (larger unit), thus some of the farms had more than one brood. Note that each farm can harbor one or several broods, and the broods are nested within farms (as opposed to crossed, see chapter <a href="lmer.html#lmer">13</a>), i.e., each brood belongs to only one farm. There are three predictors measured at the level of the farm: colony size (the number of swallow broods on that farm), cow (whether there are cows on the farm or not), and dung heap (the number of dung heaps, piles of cow dung, within 500 m of the farm).
The aim was to assess how swallows profit from insects that are attracted by livestock on the farm and by dung heaps. Broods from the same farm are not independent of each other because they belong to the same larger unit (farm), and thus share the characteristics of the farm (measured or unmeasured). Predictor variables were measured at the level of the farm, and are thus the same for all broods from a farm. In the model described and fitted below, we account for the non-independence of these clutches when building the model by including a random intercept per farm to model random variation between farms.
<!-- we could also add a random slope model later on -->
The outcome variable is a proportion (proportion fledged from clutch) and thus consists of two values for each observation, as seen with the binomial model without random factors (Section <a href="glm.html#glm">14</a>.2.2):
<!-- add correct chapter reference for GLM model -->
the number of chicks that fledged (successes) and the number of chicks that died (failures), i.e., the clutch size minus number that fledged.</p>
<p>The random factor “farm” adds a farm-specific deviation <span class="math inline">\(b_g\)</span> to the intercept in the linear predictor. These deviations are modeled as normally distributed with mean <span class="math inline">\(0\)</span> and standard deviation <span class="math inline">\(\sigma_g\)</span>.</p>
<p><span class="math display">\[
y_i \sim binomial\left(p_i, n_i\right)\\
logit\left(p_i\right) = \beta_0 + b_{g[i]} + \beta_1\;colonysize_i + \beta_2\;I\left(cow_i = 1\right) + \beta_3\;dungheap_i\\
b_g \sim normal\left(0, \sigma_g\right)
\]</span>
<!-- You may refer to these equations using \@ref(eq:y_binom), etc., fk: das hat Rmarkdown nicht geschluckt, ich habe nun die $$ verwendet--></p>
<!-- fk: can we hide/delete the selected farms in the code below?
svf: komme nicht draus wo Du meinst.fk: ich habe die schon rausgestrichen, vorher waren alle Farm-Nummern in einem R-Code-Kommentar aufgelistet-->
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="glmm.html#cb254-1" tabindex="-1"></a><span class="co"># Data on Barn Swallow (Hirundo rustica) nestling survival on farms</span></span>
<span id="cb254-2"><a href="glmm.html#cb254-2" tabindex="-1"></a><span class="co"># (a part of the data published in Grüebler et al. 2010, J Appl Ecol 47:1340-1347)</span></span>
<span id="cb254-3"><a href="glmm.html#cb254-3" tabindex="-1"></a></span>
<span id="cb254-4"><a href="glmm.html#cb254-4" tabindex="-1"></a></span>
<span id="cb254-5"><a href="glmm.html#cb254-5" tabindex="-1"></a><span class="fu">library</span>(blmeco)</span>
<span id="cb254-6"><a href="glmm.html#cb254-6" tabindex="-1"></a><span class="fu">data</span>(swallowfarms)</span>
<span id="cb254-7"><a href="glmm.html#cb254-7" tabindex="-1"></a><span class="co">#?swallowfarms # to see the documentation of the data set</span></span>
<span id="cb254-8"><a href="glmm.html#cb254-8" tabindex="-1"></a>dat <span class="ot">&lt;-</span> swallowfarms</span>
<span id="cb254-9"><a href="glmm.html#cb254-9" tabindex="-1"></a><span class="fu">str</span>(dat)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    63 obs. of  6 variables:
##  $ farm   : int  1001 1002 1002 1002 1004 1008 1008 1008 1010 1016 ...
##  $ colsize: int  1 4 4 4 1 11 11 11 3 3 ...
##  $ cow    : int  1 1 1 1 1 1 1 1 0 1 ...
##  $ dung   : int  0 0 0 0 1 1 1 1 2 2 ...
##  $ clutch : int  8 9 8 7 13 7 9 16 10 8 ...
##  $ fledge : int  8 0 6 5 9 3 7 4 9 8 ...</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="glmm.html#cb256-1" tabindex="-1"></a><span class="co"># check number of farms in the data set</span></span>
<span id="cb256-2"><a href="glmm.html#cb256-2" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>farm))</span></code></pre></div>
<pre><code>## [1] 51</code></pre>
</div>
<div id="fitting-a-binomial-mixed-model-in-r" class="section level3 hasAnchor" number="15.2.2">
<h3><span class="header-section-number">15.2.2</span> Fitting a binomial mixed model in R<a href="glmm.html#fitting-a-binomial-mixed-model-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="using-the-glmer-function" class="section level4 hasAnchor" number="15.2.2.1">
<h4><span class="header-section-number">15.2.2.1</span> Using the glmer function<a href="glmm.html#using-the-glmer-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="glmm.html#cb258-1" tabindex="-1"></a>dat<span class="sc">$</span>colsize.z <span class="ot">&lt;-</span> <span class="fu">scale</span>(dat<span class="sc">$</span>colsize) <span class="co"># z-transform values for better model convergence</span></span>
<span id="cb258-2"><a href="glmm.html#cb258-2" tabindex="-1"></a>dat<span class="sc">$</span>dung.z    <span class="ot">&lt;-</span> <span class="fu">scale</span>(dat<span class="sc">$</span>dung)</span>
<span id="cb258-3"><a href="glmm.html#cb258-3" tabindex="-1"></a>dat<span class="sc">$</span>die <span class="ot">&lt;-</span> dat<span class="sc">$</span>clutch <span class="sc">-</span> dat<span class="sc">$</span>fledge</span>
<span id="cb258-4"><a href="glmm.html#cb258-4" tabindex="-1"></a>dat<span class="sc">$</span>farm.f <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>farm)     <span class="co"># for clarity we define farm as a factor</span></span></code></pre></div>
<p>The <code>glmer</code> function uses the standard way to formulate a statistical model in R, with the outcome on the left, followed by the <code>~</code> symbol, meaning “explained by”, followed by the predictors, which are separated by <code>+</code>. The notation for the random factor with only a random intercept was introduced in chapter <a href="lmer.html#lmer">13</a> and is <code>(1|farm.f)</code> here.</p>
<p>Remember that for fitting a binomial model we have to provide the number of successful events (number of fledglings that survived) and the number of failures (those that died) within a two-column matrix that we create using the function <code>cbind</code>.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="glmm.html#cb259-1" tabindex="-1"></a><span class="co"># fit GLMM using glmer function from lme4 package</span></span>
<span id="cb259-2"><a href="glmm.html#cb259-2" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb259-3"><a href="glmm.html#cb259-3" tabindex="-1"></a>mod.glmer <span class="ot">&lt;-</span> <span class="fu">glmer</span>(<span class="fu">cbind</span>(fledge,die) <span class="sc">~</span> colsize.z <span class="sc">+</span> cow <span class="sc">+</span> dung.z <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>farm.f) , </span>
<span id="cb259-4"><a href="glmm.html#cb259-4" tabindex="-1"></a>                   <span class="at">data=</span>dat, </span>
<span id="cb259-5"><a href="glmm.html#cb259-5" tabindex="-1"></a>                   <span class="at">family=</span>binomial)</span></code></pre></div>
<div id="assessing-model-assumptions-for-the-glmer-fit" class="section level5 hasAnchor" number="15.2.2.1.1">
<h5><span class="header-section-number">15.2.2.1.1</span> Assessing model assumptions for the glmer fit<a href="glmm.html#assessing-model-assumptions-for-the-glmer-fit" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<!--fk: Reference to Figures and Tables. \@ref(type:name)-->
<p>The residuals of the model look fairly normal (top left panel of Figure <a href="glmm.html#fig:assessmodelassumptions">15.1</a> with slightly wider tails. The random intercepts for the farms look perfectly normal as they should. The plot of the residuals vs. fitted values (bottom left panel) shows a slight increase in the residuals with increasing fitted values. Positive correlations between the residuals and the fitted values are common in mixed models due to the shrinkage effect (chapter <a href="lmer.html#lmer">13</a>). Due to the same reason the fitted proportions slightly overestimate the observed proportions when these are large, but underestimate them when small (bottom right panel). What is looking like a lack of fit here can be seen as preventing an overestimation of the among farm variance based on the assumption that the farms in the data are a random sample of farms belonging to the same population.</p>
<!--fk: maybe checking the mean of the random effects is no longer needed in recent R versions?  we may check that and if it is no longer needed, delete here-->
<p>The mean of the random effects is close to zero as it should. We check that because sometimes the <code>glmer</code> function fails to correctly separate the farm-specific intercepts from the overall intercept. A non-zero mean of random effects does not mean a lack of fit, but a failure of the model fitting algorithm. In such a case, we recommend using a different fitting algorithm, e.g. <code>stan_glmer</code> from the rstanarm package or <code>brm</code> from the brms package (see below).</p>
<p>A slight overdispersion (approximated dispersion parameter &gt;1) seems to be present, but nothing to worry about.</p>

<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="glmm.html#cb260-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>))    </span>
<span id="cb260-2"><a href="glmm.html#cb260-2" tabindex="-1"></a><span class="co"># check normal distribution of residuals</span></span>
<span id="cb260-3"><a href="glmm.html#cb260-3" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">resid</span>(mod.glmer), <span class="at">main=</span><span class="st">&quot;qq-plot residuals&quot;</span>)</span>
<span id="cb260-4"><a href="glmm.html#cb260-4" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">resid</span>(mod.glmer))</span>
<span id="cb260-5"><a href="glmm.html#cb260-5" tabindex="-1"></a></span>
<span id="cb260-6"><a href="glmm.html#cb260-6" tabindex="-1"></a><span class="co"># check normal distribution of random intercepts</span></span>
<span id="cb260-7"><a href="glmm.html#cb260-7" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(mod.glmer)<span class="sc">$</span>farm.f[,<span class="dv">1</span>], <span class="at">main=</span><span class="st">&quot;qq-plot, farm&quot;</span>)</span>
<span id="cb260-8"><a href="glmm.html#cb260-8" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">ranef</span>(mod.glmer)<span class="sc">$</span>farm.f[,<span class="dv">1</span>])</span>
<span id="cb260-9"><a href="glmm.html#cb260-9" tabindex="-1"></a></span>
<span id="cb260-10"><a href="glmm.html#cb260-10" tabindex="-1"></a><span class="co"># residuals vs fitted values to check homoscedasticity</span></span>
<span id="cb260-11"><a href="glmm.html#cb260-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(mod.glmer), <span class="fu">resid</span>(mod.glmer)) </span>
<span id="cb260-12"><a href="glmm.html#cb260-12" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb260-13"><a href="glmm.html#cb260-13" tabindex="-1"></a></span>
<span id="cb260-14"><a href="glmm.html#cb260-14" tabindex="-1"></a><span class="co"># plot data vs. predicted values</span></span>
<span id="cb260-15"><a href="glmm.html#cb260-15" tabindex="-1"></a>dat<span class="sc">$</span>fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod.glmer)</span>
<span id="cb260-16"><a href="glmm.html#cb260-16" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>fitted,dat<span class="sc">$</span>fledge<span class="sc">/</span>dat<span class="sc">$</span>clutch)</span>
<span id="cb260-17"><a href="glmm.html#cb260-17" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:assessmodelassumptions"></span>
<img src="2.07-glmm_files/figure-html/assessmodelassumptions-1.png" alt="Diagnostic plots to assess model assumptions for “mod.glmer”. Upper left: quantile-quantile plot of the residuals vs. theoretical quantiles of the normal distribution. Upper right: quantile-quantile plot of the random effects “farm”. Lower left: residuals vs. fitted values. Lower right: observed vs. fitted values." width="576" />
<p class="caption">
Figure 15.1: Diagnostic plots to assess model assumptions for “mod.glmer”. Upper left: quantile-quantile plot of the residuals vs. theoretical quantiles of the normal distribution. Upper right: quantile-quantile plot of the random effects “farm”. Lower left: residuals vs. fitted values. Lower right: observed vs. fitted values.
</p>
</div>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="glmm.html#cb261-1" tabindex="-1"></a><span class="co"># check distribution of random effects</span></span>
<span id="cb261-2"><a href="glmm.html#cb261-2" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">ranef</span>(mod.glmer)<span class="sc">$</span>farm.f[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] -0.001690303</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="glmm.html#cb263-1" tabindex="-1"></a><span class="co"># check for overdispersion</span></span>
<span id="cb263-2"><a href="glmm.html#cb263-2" tabindex="-1"></a><span class="fu">dispersion_glmer</span>(mod.glmer)</span></code></pre></div>
<pre><code>## [1] 1.192931</code></pre>
<p>Quite regularly, <code>glmer</code> returns a warning of non-convergence. In many such cases, it helps to simply set the argument <code>control=glmerControl("bobyqa")</code>. If it does not help, or if you get the message of a “boundary singular fit”, <code>stan_glmer</code> may be your solution: see the following chapter with more information.</p>
</div>
</div>
<div id="using-rstanarm" class="section level4 hasAnchor" number="15.2.2.2">
<h4><span class="header-section-number">15.2.2.2</span> Using rstanarm<a href="glmm.html#using-rstanarm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A generalized linear mixed model can easily be fitted with the function <code>stan_glmer</code> from the package rstanarm. This can be particularly helpful, when <code>glmer</code> has some issues - situations we encounter more or less regularly are:</p>
<ul>
<li>When <code>glmer</code> does not converge and setting the argument <code>control=glmerControl("bobyqa")</code> does not help, <code>stan_glmer</code> might be able to fit the model.</li>
<li>“boundary (singular) fit” warning from <code>glmer</code>: This usually means that a random factor variance cannot be estimated (it gets a value of 0, so do all levels of this random factor). This may signal that the variance is small and, hence, the random factor may not be so important. But we have also encountered situations where the variance was not negligible when fitting the same model with <code>stan_glmer</code>, so checking that out when you have “singular fit” is advisable.</li>
<li><code>glmer</code> cannot fit a binomial model with a factor that has a level (or several) with only 0s or only 1s (or, in the binomial case, only 0s or only values equal to the number of trials, e.g. 7 of 7, 4 of 4 etc.). <code>stan_glmer</code>, being Bayesian, can fit a model to such data. A factor level consisting of 4 0s (and no 1s) will have an estimate near 0 and a rather wide uncertainty, a factor level consisting of 40 0s (and no 1s) will also have an estimate near 0 but with a much narrower uncertainty.</li>
</ul>
<p>In the following example we illustrate the second and third point using simulated data of a binary outcome variable (i.e. a binomial variable with number of trials = 1, also called a Bernoulli variable, and the model can be termed a logistic regression). There is one predictor: a factor called F1 with 5 levels. We also have a random factor called G.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="glmm.html#cb265-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb265-2"><a href="glmm.html#cb265-2" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb265-3"><a href="glmm.html#cb265-3" tabindex="-1"></a>ddat <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">F1 =</span> <span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">40</span>))) <span class="co"># ddat, because the object dat from above will be used again below</span></span>
<span id="cb265-4"><a href="glmm.html#cb265-4" tabindex="-1"></a>ddat<span class="sc">$</span>G <span class="ot">&lt;-</span> <span class="fu">sample</span>(letters[<span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>],<span class="fu">nrow</span>(ddat),<span class="at">replace=</span>T)   <span class="co"># just a dummy random factor to have for the glmer</span></span>
<span id="cb265-5"><a href="glmm.html#cb265-5" tabindex="-1"></a>tpe <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>F1,<span class="at">data=</span>ddat) <span class="sc">%*%</span> <span class="fu">runif</span>(<span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)    <span class="co"># true point estimate, generated using the matrix</span></span>
<span id="cb265-6"><a href="glmm.html#cb265-6" tabindex="-1"></a>   <span class="co"># model approach we also use when making effectplots from sim, explained most exhaustively in</span></span>
<span id="cb265-7"><a href="glmm.html#cb265-7" tabindex="-1"></a>   <span class="co"># the chapter on the simple linear regression</span></span>
<span id="cb265-8"><a href="glmm.html#cb265-8" tabindex="-1"></a>ddat<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(ddat),<span class="dv">1</span>,<span class="fu">plogis</span>(tpe))   <span class="co"># plogis is the inverse logit function</span></span>
<span id="cb265-9"><a href="glmm.html#cb265-9" tabindex="-1"></a></span>
<span id="cb265-10"><a href="glmm.html#cb265-10" tabindex="-1"></a>ddat<span class="sc">$</span>y[ddat<span class="sc">$</span>F1<span class="sc">==</span><span class="st">&quot;A&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb265-11"><a href="glmm.html#cb265-11" tabindex="-1"></a><span class="fu">table</span>(ddat<span class="sc">$</span>F1, ddat<span class="sc">$</span>y)  <span class="co"># note: factor level A has only 0s</span></span></code></pre></div>
<pre><code>##    
##      0  1
##   A  4  0
##   B  2  2
##   C  1  3
##   D  1  3
##   E 11 29</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="glmm.html#cb267-1" tabindex="-1"></a>  <span class="co"># for the model fit, we don&#39;t estimate an intercept (by adding a &quot;-1&quot; in the formula), because we only</span></span>
<span id="cb267-2"><a href="glmm.html#cb267-2" tabindex="-1"></a>  <span class="co"># have one factor predictor - in this way we get an estimate for the mean of each factor level,</span></span>
<span id="cb267-3"><a href="glmm.html#cb267-3" tabindex="-1"></a>  <span class="co"># rather than an intercept (= estimate for baseline level) and 4 deviations from this for the other</span></span>
<span id="cb267-4"><a href="glmm.html#cb267-4" tabindex="-1"></a>  <span class="co"># 4 levels; both approaches are the same model, just with different parametrisation (different</span></span>
<span id="cb267-5"><a href="glmm.html#cb267-5" tabindex="-1"></a>  <span class="co"># &quot;contrasts&quot;), i.e. the coefficients have different meanings.</span></span>
<span id="cb267-6"><a href="glmm.html#cb267-6" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>G), <span class="at">data=</span>ddat, <span class="at">family=</span>binomial)</span>
<span id="cb267-7"><a href="glmm.html#cb267-7" tabindex="-1"></a>  <span class="co"># the model fits, only with the singular fit warning. But look at the standard errors:</span></span>
<span id="cb267-8"><a href="glmm.html#cb267-8" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: y ~ -1 + F1 + (1 | G)
##    Data: ddat
## 
##      AIC      BIC   logLik deviance df.resid 
##     73.6     85.7    -30.8     61.6       50 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.7321 -1.0000  0.6159  0.6159  1.0000 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  G      (Intercept) 0        0       
## Number of obs: 56, groups:  G, 10
## 
## Fixed effects:
##       Estimate Std. Error z value Pr(&gt;|z|)   
## F1A -3.112e+01  2.855e+06   0.000  0.99999   
## F1B  8.508e-08  1.000e+00   0.000  1.00000   
## F1C  1.099e+00  1.155e+00   0.951  0.34139   
## F1D  1.099e+00  1.155e+00   0.951  0.34139   
## F1E  9.694e-01  3.541e-01   2.738  0.00619 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##     F1A   F1B   F1C   F1D  
## F1B 0.000                  
## F1C 0.000 0.000            
## F1D 0.000 0.000 0.000      
## F1E 0.000 0.000 0.000 0.000
## optimizer (Nelder_Mead) convergence code: 0 (OK)
## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<p>Obviously something did not work! The problem is level A with only 0s. Also, the variance of the random factor G cannot be estimated, it “collapses” to 0 and throws the singluar fit warning.
<code>stan_glmer</code> can fit this model. But let’s set all values from level E to 0, too.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="glmm.html#cb269-1" tabindex="-1"></a>ddat2 <span class="ot">&lt;-</span> ddat</span>
<span id="cb269-2"><a href="glmm.html#cb269-2" tabindex="-1"></a>ddat2<span class="sc">$</span>y[ddat2<span class="sc">$</span>F1<span class="sc">==</span><span class="st">&quot;E&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb269-3"><a href="glmm.html#cb269-3" tabindex="-1"></a>mod.rstanarm <span class="ot">&lt;-</span> <span class="fu">stan_glmer</span>(y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>G), <span class="at">data=</span>ddat2, <span class="at">family=</span>binomial, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb269-4"><a href="glmm.html#cb269-4" tabindex="-1"></a><span class="fu">summary</span>(mod.rstanarm)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">16</span>),] <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                                   mean mcse   sd    10%   50%   90% n_eff Rhat
## F1A                              -8.93 0.11 5.61 -16.82 -7.78 -2.69  2651    1
## F1B                              -0.05 0.02 1.39  -1.79 -0.05  1.64  3180    1
## F1C                               1.62 0.03 1.76  -0.36  1.42  3.85  2862    1
## F1D                               1.83 0.03 1.72  -0.16  1.64  4.01  2439    1
## F1E                              -7.37 0.05 2.73 -11.10 -6.86 -4.30  2885    1
## Sigma[G:(Intercept),(Intercept)]  1.95 0.10 3.63   0.01  0.56  5.23  1456    1</code></pre>
<p>The model fits without problem, all R-hat are good (remember: they should be near 1, ideally &lt;1.1, <a href="stan.html#stan">18</a>), coefficient estimates make sense (they are on the logit scale, of course). Both estimates for A and E are strongly negative, i.e. inverse-logit of these are close to 0, and the uncertainty for A is a bit larger than for E, which makes sense since E has many more 0s than A. Also, the standard deviation for the random factor G can now be estimated - and check it out, it is not extremely small!</p>
<p>The point estimates with 95% compatibility intervals for the 5 means are:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="glmm.html#cb271-1" tabindex="-1"></a> <span class="co"># we generate a newdat. We want to have each level of F1. And we want to be sure that the level</span></span>
<span id="cb271-2"><a href="glmm.html#cb271-2" tabindex="-1"></a> <span class="co"># order is the same as in ddat2 by setting the argument &quot;levels&quot; to levels(ddat2$F1). When the</span></span>
<span id="cb271-3"><a href="glmm.html#cb271-3" tabindex="-1"></a> <span class="co"># factor levels are ordered alpha-numerically (as in our case) this would not be needed, but if</span></span>
<span id="cb271-4"><a href="glmm.html#cb271-4" tabindex="-1"></a> <span class="co"># they have a custom order, forgetting to set the order in newdat equal to the orde in ddat2 will have</span></span>
<span id="cb271-5"><a href="glmm.html#cb271-5" tabindex="-1"></a> <span class="co"># catastrophic consequences (estimates and factor levels would be mixed up)</span></span>
<span id="cb271-6"><a href="glmm.html#cb271-6" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">F1 =</span> <span class="fu">factor</span>(<span class="fu">levels</span>(ddat2<span class="sc">$</span>F1),<span class="at">levels=</span><span class="fu">levels</span>(ddat2<span class="sc">$</span>F1)))</span>
<span id="cb271-7"><a href="glmm.html#cb271-7" tabindex="-1"></a> <span class="co"># now we can use posterior_epred, with the argument re.form=NA to not estimate for random factors</span></span>
<span id="cb271-8"><a href="glmm.html#cb271-8" tabindex="-1"></a>fitmat <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(mod.rstanarm, <span class="at">newdata=</span>newdat, <span class="at">re.form=</span><span class="cn">NA</span>)</span>
<span id="cb271-9"><a href="glmm.html#cb271-9" tabindex="-1"></a></span>
<span id="cb271-10"><a href="glmm.html#cb271-10" tabindex="-1"></a>newdat<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">apply</span>(fitmat,<span class="dv">2</span>,mean)</span>
<span id="cb271-11"><a href="glmm.html#cb271-11" tabindex="-1"></a>newdat<span class="sc">$</span>lwr <span class="ot">&lt;-</span> <span class="fu">apply</span>(fitmat,<span class="dv">2</span>,quantile,<span class="at">probs=</span><span class="fl">0.025</span>)</span>
<span id="cb271-12"><a href="glmm.html#cb271-12" tabindex="-1"></a>newdat<span class="sc">$</span>upr <span class="ot">&lt;-</span> <span class="fu">apply</span>(fitmat,<span class="dv">2</span>,quantile,<span class="at">probs=</span><span class="fl">0.975</span>)</span></code></pre></div>
<p>The effectplot can now easily be plotted (here a R base code, of course you can also ggplot it)</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="glmm.html#cb272-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">43</span>)  <span class="co"># just for the jitter</span></span>
<span id="cb272-2"><a href="glmm.html#cb272-2" tabindex="-1"></a>newdat<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlevels</span>(newdat<span class="sc">$</span>F1)</span>
<span id="cb272-3"><a href="glmm.html#cb272-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">jitter</span>(<span class="fu">as.numeric</span>(ddat2<span class="sc">$</span>F1),<span class="at">amount=</span><span class="fl">0.07</span>)<span class="sc">+</span><span class="fl">0.3</span>,<span class="fu">jitter</span>(ddat2<span class="sc">$</span>y,<span class="at">amount=</span><span class="fl">0.05</span>),<span class="at">pch=</span><span class="dv">21</span>,<span class="at">bg=</span><span class="fu">as.numeric</span>(ddat2<span class="sc">$</span>F1),</span>
<span id="cb272-4"><a href="glmm.html#cb272-4" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fu">nlevels</span>(ddat2<span class="sc">$</span>F1)<span class="sc">+</span><span class="fl">0.5</span>), <span class="at">las=</span><span class="dv">1</span>, <span class="at">ylab=</span><span class="st">&quot;y (raw data) and probability&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;F1&quot;</span>, <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb272-5"><a href="glmm.html#cb272-5" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="fu">levels</span>(newdat<span class="sc">$</span>F1),<span class="at">tick=</span>F)</span>
<span id="cb272-6"><a href="glmm.html#cb272-6" tabindex="-1"></a>newdat<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlevels</span>(newdat<span class="sc">$</span>F1)</span>
<span id="cb272-7"><a href="glmm.html#cb272-7" tabindex="-1"></a><span class="fu">segments</span>(newdat<span class="sc">$</span>x,newdat<span class="sc">$</span>lwr, newdat<span class="sc">$</span>x,newdat<span class="sc">$</span>upr, <span class="at">lwd=</span><span class="dv">1</span>)</span>
<span id="cb272-8"><a href="glmm.html#cb272-8" tabindex="-1"></a><span class="fu">points</span>(newdat<span class="sc">$</span>x, newdat<span class="sc">$</span>fit, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="fl">1.3</span>, <span class="at">bg=</span>newdat<span class="sc">$</span>x)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-7"></span>
<img src="2.07-glmm_files/figure-html/unnamed-chunk-7-1.png" alt="Raw data (points, jittered to reduce overlap) and estimated means with 95% compatiblity interval for data from 5 groups A-E and a binary outcome variable y (0/1). Groups A and E have only 0s." width="672" />
<p class="caption">
Figure 5.2: Raw data (points, jittered to reduce overlap) and estimated means with 95% compatiblity interval for data from 5 groups A-E and a binary outcome variable y (0/1). Groups A and E have only 0s.
</p>
</div>
<p>The estimates for groups B-D are uncertain, due to the small sample size for each of them. The mean of groups A and E are estimated to be near 0, with much more certainty for E that it is really most likely very small. Estimates and compatibility intervals are bound between 0 and 1, which makes sense for a probability, and which is achieved by using a logit link function in the binomial model.</p>
</div>
<div id="using-the-brm-function" class="section level4 hasAnchor" number="15.2.2.3">
<h4><span class="header-section-number">15.2.2.3</span> Using the brm function<a href="glmm.html#using-the-brm-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We have introduced <code>brm</code> from the brms package in Chapter <a href="lm.html#brm">11.1.2.4</a>.</p>
<p>In the case of a binomial outcome, the notation for <code>brm</code> is different from the notation in e.g. <code>glmer</code>: in <code>brm</code>, the binomial outcome is specified in the format <code>successes|trials()</code>, which is the number of fledged nestlings out of the total clutch size in our case. In contrast, the <code>glmer</code> function required to specify the number of nestlings that fledged and died (which together sum up to clutch size), in the format <code>cbind(successes, failures)</code>.</p>
<p>The family is also called <code>binomial</code> in <code>brm</code>, but would be <code>bernoulli</code> for a binary outcome, whereas <code>glmer</code> uses <code>binomial</code> in both situations (Bernoulli distribution is a special case of the binomial). However, it is slightly confusing that (at the time of writing this chapter) the documentation for <code>brmsfamily</code> does not mention the binomial family under Usage, where it probably went missing, but it is mentioned under Arguments for the argument family.</p>
<p>In Chapter <a href="lm.html#brm">11.1.2.4</a> we also shortly treat the priors of <code>brm</code>. In many practical cases, we simply use the default priors, which we can request using the function <code>get_prior</code> with the same arguments as we use for <code>brm</code> itself. In the case of more complex models, especially with a logit link function, it may at times help to provide slightly more informative priors for the effect sizes (the class b priors in the output from <code>get_prior</code>) than flat priors. We do that in our case, also to illustrate how priors can be specified by the function <code>prior</code>.</p>
<!-- Question to fk: but the priors chosen below seem to be quite informative! Why do you prefer these over the default priors. answer of fk: normal(0,5) means that prior to looking at the data we give effect sizes of lower than -10 or larger than +10 low probability. An effect size of +/-10 in the logit-scale changes the probability from close to 0 to close to 1 or viceversa. This is, in my opinion essentially non-informative. I fitted the model with normal(0,5) and with the default flat priors and I I do not think that the estimated effects differ markedly. with normal(0,5):  0.40 (-0.06 - 0.88) vs. with the default flat priors: 0.41 (-0.10 - 0.94). very flat priors also contain information, i.e. that effect sizes of -1000 are equally plausible as effect sizes around 0, a statement that we would not support even prior to looking at the data.-->
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="glmm.html#cb273-1" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb273-2"><a href="glmm.html#cb273-2" tabindex="-1"></a></span>
<span id="cb273-3"><a href="glmm.html#cb273-3" tabindex="-1"></a><span class="co"># check which parameters need a prior</span></span>
<span id="cb273-4"><a href="glmm.html#cb273-4" tabindex="-1"></a><span class="fu">get_prior</span>(fledge<span class="sc">|</span><span class="fu">trials</span>(clutch) <span class="sc">~</span> colsize.z <span class="sc">+</span> cow <span class="sc">+</span> dung.z <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>farm.f), </span>
<span id="cb273-5"><a href="glmm.html#cb273-5" tabindex="-1"></a>          <span class="at">data=</span>dat, </span>
<span id="cb273-6"><a href="glmm.html#cb273-6" tabindex="-1"></a>          <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<pre><code>##                 prior     class      coef  group resp dpar nlpar lb ub tag
##                (flat)         b                                           
##                (flat)         b colsize.z                                 
##                (flat)         b       cow                                 
##                (flat)         b    dung.z                                 
##  student_t(3, 0, 2.5) Intercept                                           
##  student_t(3, 0, 2.5)        sd                                   0       
##  student_t(3, 0, 2.5)        sd           farm.f                  0       
##  student_t(3, 0, 2.5)        sd Intercept farm.f                  0       
##        source
##       default
##  (vectorized)
##  (vectorized)
##  (vectorized)
##       default
##       default
##  (vectorized)
##  (vectorized)</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="glmm.html#cb275-1" tabindex="-1"></a><span class="co"># specify own priors</span></span>
<span id="cb275-2"><a href="glmm.html#cb275-2" tabindex="-1"></a>myprior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">class=</span><span class="st">&quot;b&quot;</span>)</span>
<span id="cb275-3"><a href="glmm.html#cb275-3" tabindex="-1"></a>             </span>
<span id="cb275-4"><a href="glmm.html#cb275-4" tabindex="-1"></a><span class="co"># as before, we save the compiled model, just to speed up the rendering of the book - </span></span>
<span id="cb275-5"><a href="glmm.html#cb275-5" tabindex="-1"></a><span class="co"># in analyses, you may or may not store the compiled model.</span></span>
<span id="cb275-6"><a href="glmm.html#cb275-6" tabindex="-1"></a></span>
<span id="cb275-7"><a href="glmm.html#cb275-7" tabindex="-1"></a><span class="co"># mod.glmm.brm &lt;- brm(fledge|trials(clutch) ~ colsize.z + cow + dung.z + (1|farm.f) , </span></span>
<span id="cb275-8"><a href="glmm.html#cb275-8" tabindex="-1"></a><span class="co">#                data=dat, family=binomial(link=&quot;logit&quot;),</span></span>
<span id="cb275-9"><a href="glmm.html#cb275-9" tabindex="-1"></a><span class="co">#                prior=myprior, chains = 0)</span></span>
<span id="cb275-10"><a href="glmm.html#cb275-10" tabindex="-1"></a><span class="co"># save(mod.glmm.brm, file=&quot;RData/mod.glmm.brm.RData&quot;)</span></span>
<span id="cb275-11"><a href="glmm.html#cb275-11" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;RData/mod.glmm.brm.RData&quot;</span>)</span>
<span id="cb275-12"><a href="glmm.html#cb275-12" tabindex="-1"></a>mod.brm <span class="ot">&lt;-</span> <span class="fu">update</span>(mod.glmm.brm,</span>
<span id="cb275-13"><a href="glmm.html#cb275-13" tabindex="-1"></a>               <span class="at">warmup =</span> <span class="dv">500</span>, </span>
<span id="cb275-14"><a href="glmm.html#cb275-14" tabindex="-1"></a>               <span class="at">iter =</span> <span class="dv">2000</span>, </span>
<span id="cb275-15"><a href="glmm.html#cb275-15" tabindex="-1"></a>               <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb275-16"><a href="glmm.html#cb275-16" tabindex="-1"></a>               <span class="at">init =</span> <span class="st">&quot;random&quot;</span>, </span>
<span id="cb275-17"><a href="glmm.html#cb275-17" tabindex="-1"></a>               <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb275-18"><a href="glmm.html#cb275-18" tabindex="-1"></a>               <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb275-19"><a href="glmm.html#cb275-19" tabindex="-1"></a><span class="co"># note: thin=1 is default and we did not change this here.</span></span></code></pre></div>
<!-- Question to fk: I pasted this part of the code to this separate chunk. Do we need it and should I explain it?
and why did you exclude the random intercept? Or did I do this by mistake?, fk: only in this code we see that the prior for the variance parameter is restricted to positive values. I would not show the code, otherwise we have to explain the Stan code. It is a good idea to have it in a junk that is not shown.
pko 17.10.25: I have introduced the make_stancode where brm is first introduced in the lm chapter, I think it can be deleted here...
-->
<!-- moved to chapter lm - but may be still do the mcmc_plot here?

##### Checking model convergence for the brm fit

We first check whether we find warnings in the R console about problems of the fitting algorithm. Warnings should be taken seriously. Often, we find help in the Stan online documentation (or when typing `launch_shinystan(mod.brm)` into the R-console) what to change when calling the `brm` function to get a fit that is running smoothly. Once, we get rid of all warnings, we need to check how well the Markov chains mixed. We can either do that by scanning through the many diagnostic plots given by `launch_shinystan(mod)` or create the most important plots ourselves such as the traceplot (Figure \@ref(fig:checkconvergencemodelbrm)). 


```r
par(mar=c(2,2,2,2))
mcmc_plot(mod.brm, type = "trace")
```

<div class="figure">
<img src="2.07-glmm_files/figure-html/checkconvergencemodelbrm-1.png" alt="Traceplot of the Markov chains. After convergence, both Markov chains should sample from the same stationary distribution. Indications of non-convergence would be, if the two chains diverge or vary around different means." width="672" />
<p class="caption">(\#fig:checkconvergencemodelbrm)Traceplot of the Markov chains. After convergence, both Markov chains should sample from the same stationary distribution. Indications of non-convergence would be, if the two chains diverge or vary around different means.</p>
</div>
-->
<!--siehe Kapitel 5.3 hier: https://www.rensvandeschoot.com/tutorials/generalised-linear-models-with-brms/, fk: dieses Buch ist auch noch under construction. Ich würde glaubs nur zu fertigen Büchern einen Link anfügen.-->
<div id="postpredmodcheck" class="section level5 hasAnchor" number="15.2.2.3.1">
<h5><span class="header-section-number">15.2.2.3.1</span> Checking model fit by posterior predictive model checking<a href="glmm.html#postpredmodcheck" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To assess how well the model fits to the data we do posterior predictive model checking (Chapter <a href="modelchecking.html#modelchecking">16</a>). For binomial as well as for Poisson models comparing the standard deviation of the data with those of replicated data from the model is particularly important. If the standard deviation of the real data would be much higher compared to the ones of the replicated data from the model, overdispersion would be an issue. However, here, the model is able to capture the variance in the data correctly (Figure <a href="glmm.html#fig:ppbinomial">15.2</a>).
The fitted vs observed plot also shows a good fit.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="glmm.html#cb276-1" tabindex="-1"></a>yrep <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(mod.brm)</span>
<span id="cb276-2"><a href="glmm.html#cb276-2" tabindex="-1"></a>sdyrep <span class="ot">&lt;-</span> <span class="fu">apply</span>(yrep, <span class="dv">1</span>, sd)</span>
<span id="cb276-3"><a href="glmm.html#cb276-3" tabindex="-1"></a></span>
<span id="cb276-4"><a href="glmm.html#cb276-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb276-5"><a href="glmm.html#cb276-5" tabindex="-1"></a><span class="fu">hist</span>(yrep, <span class="at">freq=</span><span class="cn">FALSE</span>, <span class="at">main=</span><span class="cn">NA</span>, <span class="at">xlab=</span><span class="st">&quot;Number of fledglings&quot;</span>)</span>
<span id="cb276-6"><a href="glmm.html#cb276-6" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>fledge, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.3</span>), <span class="at">freq=</span><span class="cn">FALSE</span>)</span>
<span id="cb276-7"><a href="glmm.html#cb276-7" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">10</span>, <span class="fl">0.15</span>, <span class="at">fill=</span><span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.3</span>)), <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;yrep&quot;</span>, <span class="st">&quot;y&quot;</span>))</span>
<span id="cb276-8"><a href="glmm.html#cb276-8" tabindex="-1"></a></span>
<span id="cb276-9"><a href="glmm.html#cb276-9" tabindex="-1"></a><span class="fu">hist</span>(sdyrep)</span>
<span id="cb276-10"><a href="glmm.html#cb276-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">sd</span>(dat<span class="sc">$</span>fledge), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb276-11"><a href="glmm.html#cb276-11" tabindex="-1"></a></span>
<span id="cb276-12"><a href="glmm.html#cb276-12" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(mod.brm)[,<span class="dv">1</span>], dat<span class="sc">$</span>fledge, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.6</span>)</span>
<span id="cb276-13"><a href="glmm.html#cb276-13" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ppbinomial"></span>
<img src="2.07-glmm_files/figure-html/ppbinomial-1.png" alt="Posterior predictive model checking: Histogram of the number of fledglings simulated from the model together with a histogram of the real data, and a histogram of the standard deviations of replicated data from the model together with the standard deviation of the data (vertical line in red). The third plot gives the fitted vs. observed values." width="672" />
<p class="caption">
Figure 15.2: Posterior predictive model checking: Histogram of the number of fledglings simulated from the model together with a histogram of the real data, and a histogram of the standard deviations of replicated data from the model together with the standard deviation of the data (vertical line in red). The third plot gives the fitted vs. observed values.
</p>
</div>
<p>Another classical question we can address using posterior predictive model checking is whether we have zero-inflation, i.e. whether the data has more zeros than the model predicts. In our example, there is only one Zero among 63 data rows, hence this is certainly not an issue. Nevertheless, we provide the code how this could be checked (analogous to checking the standard deviation done above).</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="glmm.html#cb277-1" tabindex="-1"></a>Zeroyrep <span class="ot">&lt;-</span> <span class="fu">apply</span>(yrep, <span class="dv">1</span>, <span class="at">FUN=</span><span class="cf">function</span>(x)<span class="fu">sum</span>(x<span class="sc">==</span><span class="dv">0</span>))   <span class="co"># count the nr of zeros in each replicate data</span></span>
<span id="cb277-2"><a href="glmm.html#cb277-2" tabindex="-1"></a><span class="fu">hist</span>(Zeroyrep, <span class="at">xlab=</span><span class="st">&quot;Nr of zeros&quot;</span>, <span class="at">xlim=</span><span class="fu">range</span>(<span class="fu">c</span>(Zeroyrep,<span class="fu">sum</span>(dat<span class="sc">$</span>fledge<span class="sc">==</span><span class="dv">0</span>))))</span>
<span id="cb277-3"><a href="glmm.html#cb277-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">sum</span>(dat<span class="sc">$</span>fledge<span class="sc">==</span><span class="dv">0</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb277-4"><a href="glmm.html#cb277-4" tabindex="-1"></a>  <span class="co"># the red line should not be far outside the gray histogram; the xlim used in the histogram</span></span>
<span id="cb277-5"><a href="glmm.html#cb277-5" tabindex="-1"></a>  <span class="co"># makes sure that the red line will be visible in the plot, because sometimes it can be far</span></span>
<span id="cb277-6"><a href="glmm.html#cb277-6" tabindex="-1"></a>  <span class="co"># away from the histogram (which would show that the model is not great regarding Zeros)</span></span></code></pre></div>
<p>After checking the diagnostic plots, the posterior predictive model checking and the general model fit, we assume that the model describes the data generating process reasonably well, so that we can proceed to make inferences from the model.</p>
</div>
</div>
</div>
<div id="presenting-the-results-2" class="section level3 hasAnchor" number="15.2.3">
<h3><span class="header-section-number">15.2.3</span> Presenting the results<a href="glmm.html#presenting-the-results-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The generic <code>summary</code> function gives us the results for the model object containing the fitted model, and works for both the model fitted with <code>glmer</code> and <code>brm</code>. Let’s start having a look at the summary from <code>mod.glmer</code>.
The summary provides the fitting method, the model formula, statistics for the model fit including the Akaike information criterion (AIC), the Bayesian information criterion (BIC), the scaled residuals, the random effects variance and information about observations and groups, a table with coefficient estimates for the fixed effects (with standard errors and a z-test for the coefficient) and correlations between fixed effects. We recommend to always check if the number of observations and groups, i.e., 63 barn swallow nests from 51 farms here, is correct. This information shows if the <code>glmer</code> function has correctly recognized the hierarchical structure in the data. Here, this is correct. To assess the associations between the predictor variables and the outcome analyzed, we need to look at the column “Estimate” in the table of fixed effects. This column contains the estimated model coefficients, and the standard error for these estimates is given in the column “Std. Error”, along with a z-test for the null hypothesis of a coefficient of zero.
In the random effects table, the among farm variance and standard deviation (square root of the variance) are given.
The function <code>confint</code> shows the 95% confidence intervals for the random effects (<code>.sig01</code>) and fixed effects estimates.</p>
<p>In the <code>summary</code> output from <code>mod.brm</code> we see the model formula and some information on the Markov chains after the warm-up. In the group-level effects (between group standard deviations) and population-level effects (effect sizes, model coefficients) tables some summary statistics of the posterior distribution of each parameter are given. The “Estimate” is the mean of the posterior distribution, the “Est.Error” is the standard deviation of the posterior distribution (which is the standard error of the parameter estimate). Then we see the lower and upper limit of the 95% credible interval. Also, some statistics for measuring how well the Markov chains converged are given: the “Rhat” and the effective sample size (ESS). The bulk ESS tells us how many independent samples we have to describe the posterior distribution, and the tail ESS tells us on how many samples the limits of the 95% credible interval is based on.</p>
<p>Because we used the logit link function, the coefficients are actually on the logit scale and are a bit difficult to interpret. What we can say is that positive coefficients indicate an increase and negative coefficients indicate a decrease in the proportion of nestlings fledged. For continuous predictors, as colsize.z and dung.z, this coefficient refers to the change in the logit of the outcome with a change of one in the predictor (e.g., for colsize.z an increase of one corresponds to an increase of a standard deviation of colsize). For categorical predictors, the coefficients represent a difference between one category and another (reference category is the one not shown in the table).
To visualize the coefficients we could draw effect plots.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="glmm.html#cb278-1" tabindex="-1"></a><span class="co"># glmer</span></span>
<span id="cb278-2"><a href="glmm.html#cb278-2" tabindex="-1"></a><span class="fu">summary</span>(mod.glmer)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: cbind(fledge, die) ~ colsize.z + cow + dung.z + (1 | farm.f)
##    Data: dat
## 
##      AIC      BIC   logLik deviance df.resid 
##    282.5    293.2   -136.3    272.5       58 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.2071 -0.4868  0.0812  0.6210  1.8905 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  farm.f (Intercept) 0.2058   0.4536  
## Number of obs: 63, groups:  farm.f, 51
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept) -0.09533    0.19068  -0.500   0.6171  
## colsize.z    0.05087    0.11735   0.434   0.6646  
## cow          0.39370    0.22692   1.735   0.0827 .
## dung.z      -0.14236    0.10862  -1.311   0.1900  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##           (Intr) clsz.z cow   
## colsize.z  0.129              
## cow       -0.828 -0.075       
## dung.z     0.033  0.139 -0.091</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="glmm.html#cb280-1" tabindex="-1"></a>confint<span class="fl">.95</span> <span class="ot">&lt;-</span> <span class="fu">confint</span>(mod.glmer); confint<span class="fl">.95</span></span></code></pre></div>
<pre><code>##                   2.5 %    97.5 %
## .sig01       0.16809483 0.7385238
## (Intercept) -0.48398346 0.2863200
## colsize.z   -0.18428769 0.2950063
## cow         -0.05360035 0.8588134
## dung.z      -0.36296714 0.0733620</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="glmm.html#cb282-1" tabindex="-1"></a><span class="co"># brm</span></span>
<span id="cb282-2"><a href="glmm.html#cb282-2" tabindex="-1"></a><span class="fu">summary</span>(mod.brm)</span></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: fledge | trials(clutch) ~ colsize.z + cow + dung.z + (1 | farm.f) 
##    Data: dat (Number of observations: 63) 
##   Draws: 2 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup draws = 3000
## 
## Multilevel Hyperparameters:
## ~farm.f (Number of levels: 51) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.55      0.16     0.26     0.86 1.00      910     1284
## 
## Regression Coefficients:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.10      0.21    -0.52     0.32 1.00     2863     2165
## colsize.z     0.05      0.14    -0.21     0.34 1.00     2266     1794
## cow           0.41      0.25    -0.06     0.90 1.00     3069     2117
## dung.z       -0.15      0.12    -0.38     0.09 1.00     3254     2241
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>From the results we conclude that in farms without cows (when cow=0) and for average colony sizes (when colsize.z=0) and average number of dung heaps (when dung.z=0) the average nestling survival of Barn swallows is the inverse-logit function of the Intercept, thus, <code>plogis(</code>-0.1<code>)</code> = 0.47 with a 95% uncertainty interval of 0.37 - 0.58. We further see that colony size and number of dung heaps are less important than whether cows are present or not. Their estimated partial effect is small and their uncertainty interval includes only values close to zero. However, whether cows are present or not may be important for the survival of nestlings. The average nestling survival in farms with cows is <code>plogis(</code>-0.1<code>+</code>0.41<code>)</code> = 0.58. For getting the uncertainty interval of this survival estimate, we need to do the calculation for every simulation from the posterior distribution of both parameters.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="glmm.html#cb284-1" tabindex="-1"></a>bsim <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(mod.brm)</span>
<span id="cb284-2"><a href="glmm.html#cb284-2" tabindex="-1"></a><span class="co"># survival of nestlings on farms with cows:</span></span>
<span id="cb284-3"><a href="glmm.html#cb284-3" tabindex="-1"></a>survivalest <span class="ot">&lt;-</span> <span class="fu">plogis</span>(bsim<span class="sc">$</span>b_Intercept <span class="sc">+</span> bsim<span class="sc">$</span>b_cow)</span>
<span id="cb284-4"><a href="glmm.html#cb284-4" tabindex="-1"></a><span class="fu">quantile</span>(survivalest, <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) <span class="co"># 95% uncertainty interval</span></span></code></pre></div>
<pre><code>##      2.5%     97.5% 
## 0.5126716 0.6412675</code></pre>
<p>In medical research, it is standard to report the fixed-effects coefficients from GLMM with binomial or Bernoulli error as odds ratios by taking the exponent (R function <code>exp</code> for <span class="math inline">\(e^{()}\)</span>) of the coefficient on the logit-scale. For example, the coefficient for cow from <code>mod.glmer</code>, 0.39 (95% CI from -0.05 to -0.05), represents an odds ratio of exp(
0.39)=1.48 (95% CI from 0.95 to 0.95). This means that the odds for fledging (vs. not fledging) from a clutch from a farm with livestock present is about 1.5 times larger than the odds for fledging if no livestock is present (relative effect).</p>
</div>
</div>
<div id="poisson-mixed-model" class="section level2 hasAnchor" number="15.3">
<h2><span class="header-section-number">15.3</span> Poisson mixed model<a href="glmm.html#poisson-mixed-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="summary-2" class="section level2 hasAnchor" number="15.4">
<h2><span class="header-section-number">15.4</span> Summary<a href="glmm.html#summary-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="glm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modelchecking.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TobiasRoth/BDAEcology/edit/master/2.07-glmm.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
